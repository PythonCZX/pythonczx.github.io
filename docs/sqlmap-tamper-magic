<!DOCTYPE html><html lang="en" data-theme="classic"><head><title>Sqlmagic, the Tamper Spell</title><link rel="shortcut icon" href="/assets/img/favicon.ico"><link rel="alternate" type="application/rss+xml" title="All Content Feed" href="https://shellsharks.com/feeds/all-feed.xml"><link rel="alternate" type="application/rss+xml" title="Post Feed" href="https://shellsharks.com/feeds/feed.xml"><link rel="alternate" type="application/rss+xml" title="Scrolls Feed" href="https://shellsharks.com/feeds/scroll-feed.xml"><link rel="alternate" type="application/rss+xml" title="Infosec Feed" href="https://shellsharks.com/feeds/infosec-feed.xml"><link rel="alternate" type="application/rss+xml" title="Notes Feed" href="https://shellsharks.com/feeds/note-feed.xml"><link rel="alternate" type="application/rss+xml" title="Devlogs Feed" href="https://shellsharks.com/feeds/devlog-feed.xml"><link rel="alternate" type="application/rss+xml" title="Links Feed" href="https://shellsharks.com/feeds/link-feed.xml"><link rel="alternate" type="application/rss+xml" title="Captains Log Feed" href="https://shellsharks.com/feeds/log-feed.xml"><link rel="alternate" type="application/rss+xml" title="Social Web Feed" href="https://shellsharks.com/feeds/socialweb-feed.xml"><link rel="alternate" type="application/rss+xml" title="Life Feed" href="https://shellsharks.com/feeds/life-feed.xml"><link rel="blogroll" type="text/xml" href="https://shellsharks.com/assets/rsrc/shellsharks-blogroll.opml"><link type="text/plain" rel="author" href="https://shellsharks.com/humans.txt" /><link rel="canonical" href="https://shellsharks.com/sqlmap-tamper-magic"><link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png"><link rel="indieweb" href="/indieweb.txt" /><link href="https://github.com/shellsharks" rel="me"> <!--IndieAuth Provider--><link rel="authorization_endpoint" href="https://indieauth.com/auth"> <!--IndieAuth--><link rel="token_endpoint" href="https://tokens.indieauth.com/token"> <!--IndieAuth token endpoint--> <!--needed for button css--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"><link href='/assets/css/style.css' rel='stylesheet' type='text/css'><link href="/assets/css/syntax.css" rel="stylesheet" ><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" /><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" /><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css" /><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Michael Sass" /><meta name="description" content="How to use Sqlmap Tamper scripts to inject precise, transform-required payloads." /><meta name="keywords" content="Sqlmagic, the Tamper Spell, shellsharks, infosec, appsec, pentesting, red, kali, training, burp, technical" /><meta content="shellsharks" property="og:site_name" /><meta name="fediverse:creator" content="@shellsharks@shellsharks.social" /><meta name="robots" content="noai, noimageai, noml" /> <!--https://noml.info--> <script> const currentThemeX = localStorage.getItem('theme') ? localStorage.getItem('theme') : null; if (currentThemeX) { document.documentElement.setAttribute('data-theme', currentThemeX); } else if (matchMedia('(prefers-color-scheme: light)').matches) { localStorage.setItem('theme', "light"); } else if (matchMedia('(prefers-color-scheme: dark)').matches) { localStorage.setItem('theme', "classic"); } else { localStorage.setItem('theme', "classic"); } </script><meta content="Sqlmagic, the Tamper Spell" property="og:title"><meta content="article" property="og:type"><meta content="How to use Sqlmap Tamper scripts to inject precise, transform-required payloads." property="og:description"><meta content="https://shellsharks.com/sqlmap-tamper-magic" property="og:url"><meta content="2021-07-27T10:50:00-04:00" property="article:published_time"><meta content="https://shellsharks.com/about/" property="article:author"><meta content="https://shellsharks-images.s3.amazonaws.com/2021/sorcerer-shark.png" property="og:image"><meta content="infosec" property="article:section"><meta content="infosec" property="article:tag"><meta content="appsec" property="article:tag"><meta content="pentesting" property="article:tag"><meta content="red" property="article:tag"><meta content="kali" property="article:tag"><meta content="training" property="article:tag"><meta content="burp" property="article:tag"><meta content="technical" property="article:tag"> <script src="/assets/js/finrand.js"></script><style> @media (max-width: 2048px) { main { width:66%; } } @media (max-width: 1800px) { main { max-width:800px; width:95%; } } @media (max-width: 768px) { main { width:95%; } }</style><body><div class="container"><heading class="container_item"><style> /* * Made by Erik Terwan * 24th of November 2015 * MIT License * * * If you are thinking of using this in * production code, beware of the browser * prefixes. */ #menuToggle { display: block; position: relative; z-index: 1; -webkit-user-select: none; user-select: none; } #menuToggle a { text-decoration: none; transition: color 0.3s ease; color: var(--contrast-font-color); } .menu_section { color: var(--light-font-color); font-weight: 900; } .menu_section:nth-of-type(n+2) { margin-top:20px; } #menuToggle a:hover { color: var(--link-hover-color); } #menuToggle input { display: block; width: 40px; height: 32px; position: absolute; /*top: -7px;*/ /*left: -5px;*/ cursor: pointer; opacity: 0; /* hide this */ z-index: 2; /* and place it over the hamburger */ -webkit-touch-callout: none; } /* * Just a quick hamburger */ #menuToggle span { display: block; width: 27px; height: 3px; margin-bottom: 4px; position: relative; margin-top:4px; background: var(--font-color); border-radius: 3px; z-index: 1; transform-origin: 4px 0px; transition: transform 0.5s cubic-bezier(0.77,0.2,0.05,1.0), background 0.5s cubic-bezier(0.77,0.2,0.05,1.0), opacity 0.55s ease; } #menuToggle span:first-child { transform-origin: 0% 0%; } #menuToggle span:nth-last-child(2) { transform-origin: 0% 100%; } /* * Transform all the slices of hamburger * into a crossmark. */ #menuToggle input:checked ~ span { opacity: 1; transform: rotate(45deg) translate(-2px, -1px); background: var(--link-hover-color); } /* * But let's hide the middle one. */ #menuToggle input:checked ~ span:nth-last-child(3) { opacity: 0; transform: rotate(0deg) scale(0.2, 0.2); } /* * Ohyeah and the last one should go the other direction */ #menuToggle input:checked ~ span:nth-last-child(2) { transform: rotate(-45deg) translate(0, -1px); } /* * Make this absolute positioned * at the top left of the screen */ #menu { position: absolute; left:-10px; width: 200px; /*fit-content;*/ padding: 10px; margin-top:10px; /*display:none;*/ background: var(--light-background-color); color:var(--font-color); list-style-type: none; -webkit-font-smoothing: antialiased; max-height: calc(80vh); overflow:auto; overscroll-behavior: contain; border-radius: 5px; /* to stop flickering of text in safari */ } /* * And let's slide it in from the left */ #menuToggle input:checked ~ ul { display:block; } .hidden { display: none; }</style><div role="navigation" id="hamburger"><div id="menuToggle"> <input type="checkbox" /> <span></span> <span></span> <span></span><ul id="menu" class="hidden"><li class="menu_section">Main<li><a href="/home/feed" ><i class="ph ph-house"></i> Home Feed</a><li><a href="/about" ><i class="ph ph-identification-card"></i> About</a><li><a href="/feeds" ><i class="ph ph-rss"></i> Feeds</a><li><a href="/activity" ><i class="ph ph-pulse"></i> Activity</a><li><a href="https://shellsharks.social/@shellsharks" target="_blank"><i class="ph ph-mastodon-logo"></i> Mastodon</a><li><a href="mailto:mike@shellsharks.com" ><i class="ph ph-envelope"></i> Email</a><li><a href="https://ko-fi.com/shellsharks" ><i class="ph ph-coffee"></i> Buy me a Coffee</a><li id="themetoggler"><i class="ph ph-swatches" id="themetoggle"></i> Toggle theme<li class="menu_section">Site Nav<li><a href="/scrolls" ><i class="ph ph-scroll"></i> Scrolls Newsletter</a><li><a href="/podcast" ><i class="ph ph-microphone"></i> The Shellsharks Podcast</a><li><a href="/notebook" ><i class="ph ph-note"></i> Notebook</a><li><a href="/blogs" ><i class="ph ph-article"></i> Blogs</a><li><a href="/blogs/infosec" ><i class="ph ph-bug"></i> Infosec Blogs</a><li><a href="/captains-log" ><i class="ph-fill ph-notebook"></i> Captain's Log</a><li><a href="/devlog" ><i class="ph ph-code-block"></i> Devlog</a><li><a href="/linklog" ><i class="ph ph-link"></i> Linklog</a><li><a href="/blogroll" ><i class="ph ph-paint-roller"></i> Blogroll</a><li><a href="/fediverse" ><i class="ph ph-fediverse-logo"></i> Fediverse ⁂</a><li><a href="/slashes" ><i class="ph ph-folder-simple-star"></i> Slashes</a><li><a href="/uses" ><i class="ph ph-hammer"></i> Uses</a><li><a href="/now" ><i class="ph ph-clock"></i> Now</a><li><a href="/tags" ><i class="ph ph-tag"></i> Tags</a><li><a href="/statboard" ><i class="ph ph-gauge"></i> Statboard</a><li><a href="/changelog" ><i class="ph ph-arrows-left-right"></i> Change Log</a><li><a href="/interests" ><i class="ph ph-heart"></i> Interests</a><li><a href="/ideas" ><i class="ph ph-lightbulb-filament"></i> Ideas</a><li><a href="/bookmarks" ><i class="ph ph-bookmarks"></i> Bookmarks</a><li><a href="/resume" ><i class="ph ph-read-cv-logo"></i> Resume</a><li><a href="/pro" ><i class="ph ph-seal"></i> Shellsharks Pro</a><li><a href="/sharkweek" ><i class="ph ph-calendar-heart"></i> >Shark Week</a><li><a href="/architecture" ><i class="ph ph-blueprint"></i> Architecture</a><li><a href="/roadmap" ><i class="ph ph-road-horizon"></i> Roadmap</a><li><a href="/tags?tag=bestof#info" ><i class="ph ph-star"></i> Best</a><li><a href="/projects" ><i class="ph ph-compass-tool"></i> Projects</a><li><a href="/now#supporting" ><i class="ph ph-hand-heart"></i> Supports</a><li><a href="/uses#referrals" ><i class="ph ph-hand-arrow-up"></i> Referrals</a><li><a href="/style" ><i class="ph ph-frame-corners"></i> Style</a><li><a href="/.well-known/security.txt" ><i class="ph ph-bug"></i> Report a Bug</a><li><a href="/humans.txt" ><i class="ph ph-user-rectangle"></i> Humans</a><li><a href="/disclaimer" ><i class="ph ph-info"></i> License & Disclaimer</a><li><a href="/privacy" ><i class="ph ph-cookie"></i> Privacy</a><li><a href="/starsharks" ><i class="ph ph-sparkle"></i> Starsharks</a><li><a href="/chipotle" ><i class="ph ph-pepper"></i> Chipotle</a><li><a href="/misc" ><i class="ph ph-paperclip"></i> Junk Drawer</a><li><a href="/ocean" ><i class="ph ph-waves"></i> the Ocean</a><li><a href="/void" ><i class="ph ph-spiral"></i> the Void</a><li class="menu_section">Other<li><a href="/public.pgp" ><i class="ph ph-key"></i> PGP Public Key</a><li><a href="https://infosec.pub/c/cybersecurity" target="_blank"><i class="ph ph-hamburger"></i> Infosec.Pub</a><li><a href="https://malici.ous.computer/@shellsharks" target="_blank"><i class="ph ph-linux-logo"></i> malici.ous.computer</a><li><a href="https://mastodon.social/@sass" target="_blank"><i class="ph-fill ph-mastodon-logo"></i> Mastodon.Social</a><li><a href="https://discord.gg/3rkHgtcYbb" target="_blank"><i class="ph ph-discord-logo"></i> Shellsharks Discord</a><li><a href="https://www.linkedin.com/in/mikesass" target="_blank"><i class="ph ph-linkedin-logo"></i> Linkedin</a><li><a href="/toots/infosec-exchange/shellsharks/" ><i class="ph ph-database"></i> Infosec.exchange Toot Archive</a><li><a href="https://github.com/shellsharks" target="_blank"><i class="ph ph-github-logo"></i> Github</a><li><a href="https://fediverse-webring-enthusiasts.glitch.me/profiles/shellsharks_infosec.exchange/index.html" target="_blank"><i class="ph ph-circle"></i> Webring Enthusiasts</a><li><a href="https://fedia.io/m/cybersecurity" target="_blank"><i class="ph ph-square-half"></i> Fedia.io</a><li><img src="/assets/img/avatar.png" height="50" style="position: relative; display: block; margin:auto; margin-top:20px; margin-bottom:20px;" /></ul></div></div><!-- window.onload = function() { var menuButton = document.getElementById('menuToggle'); var menu = document.getElementById('menu'); menu.classList.add('hidden'); document.getElementById("menuToggle").children[0].checked = false; } --> <script> const menuButton = document.getElementById('menuToggle'); const menu = document.getElementById('menu'); var links = menu.querySelectorAll('a'); menuButton.addEventListener('click', () => { if (!menu.contains(event.target)) { menu.classList.toggle('hidden'); } }); document.addEventListener('click', (event) => { if (!menu.contains(event.target) && !menuButton.contains(event.target)) { menu.classList.add('hidden'); if (document.getElementById("menuToggle").children[0].checked) { document.getElementById("menuToggle").children[0].checked = !document.getElementById("menuToggle").children[0].checked; } } }); links.forEach(function(link) { link.addEventListener('click', function(event) { document.querySelector("#hamburger").click(); }); }); </script> <img id="title_image" src="/assets/img/shellsharks.gif" alt="Shellsharks>_" onclick='window.open("/","_self")'> <span style="float:right;"><a href="/search"><i class="ph-bold ph-magnifying-glass" style="color:var(--font-color); font-size:1.6em; top:-2px;"></i></a></span> </heading><nav class="container_item"><ul id="nav_menu" style="list-style-type:none;padding-left: 10px;"><li class="menu_section">Main<li><a href="/home/feed" ><i class="ph ph-house"></i> Home Feed</a><li><a href="/about" ><i class="ph ph-identification-card"></i> About</a><li><a href="/feeds" ><i class="ph ph-rss"></i> Feeds</a><li><a href="/activity" ><i class="ph ph-pulse"></i> Activity</a><li><a href="https://shellsharks.social/@shellsharks" target="_blank"><i class="ph ph-mastodon-logo"></i> Mastodon</a><li><a href="mailto:mike@shellsharks.com" ><i class="ph ph-envelope"></i> Email</a><li><a href="https://ko-fi.com/shellsharks" ><i class="ph ph-coffee"></i> Buy me a Coffee</a><li id="themetoggler"><i class="ph ph-swatches" id="themetoggle"></i> Toggle theme<li class="menu_section">Site Nav<li><a href="/scrolls" ><i class="ph ph-scroll"></i> Scrolls Newsletter</a><li><a href="/podcast" ><i class="ph ph-microphone"></i> The Shellsharks Podcast</a><li><a href="/notebook" ><i class="ph ph-note"></i> Notebook</a><li><a href="/blogs" ><i class="ph ph-article"></i> Blogs</a><li><a href="/blogs/infosec" ><i class="ph ph-bug"></i> Infosec Blogs</a><li><a href="/captains-log" ><i class="ph-fill ph-notebook"></i> Captain's Log</a><li><a href="/devlog" ><i class="ph ph-code-block"></i> Devlog</a><li><a href="/linklog" ><i class="ph ph-link"></i> Linklog</a><li><a href="/blogroll" ><i class="ph ph-paint-roller"></i> Blogroll</a><li><a href="/fediverse" ><i class="ph ph-fediverse-logo"></i> Fediverse ⁂</a><li><a href="/slashes" ><i class="ph ph-folder-simple-star"></i> Slashes</a><li><a href="/uses" ><i class="ph ph-hammer"></i> Uses</a><li><a href="/now" ><i class="ph ph-clock"></i> Now</a><li><a href="/tags" ><i class="ph ph-tag"></i> Tags</a><li><a href="/statboard" ><i class="ph ph-gauge"></i> Statboard</a><li><a href="/changelog" ><i class="ph ph-arrows-left-right"></i> Change Log</a><li><a href="/interests" ><i class="ph ph-heart"></i> Interests</a><li><a href="/ideas" ><i class="ph ph-lightbulb-filament"></i> Ideas</a><li><a href="/bookmarks" ><i class="ph ph-bookmarks"></i> Bookmarks</a><li><a href="/resume" ><i class="ph ph-read-cv-logo"></i> Resume</a><li><a href="/pro" ><i class="ph ph-seal"></i> Shellsharks Pro</a><li><a href="/sharkweek" ><i class="ph ph-calendar-heart"></i> >Shark Week</a><li><a href="/architecture" ><i class="ph ph-blueprint"></i> Architecture</a><li><a href="/roadmap" ><i class="ph ph-road-horizon"></i> Roadmap</a><li><a href="/tags?tag=bestof#info" ><i class="ph ph-star"></i> Best</a><li><a href="/projects" ><i class="ph ph-compass-tool"></i> Projects</a><li><a href="/now#supporting" ><i class="ph ph-hand-heart"></i> Supports</a><li><a href="/uses#referrals" ><i class="ph ph-hand-arrow-up"></i> Referrals</a><li><a href="/style" ><i class="ph ph-frame-corners"></i> Style</a><li><a href="/.well-known/security.txt" ><i class="ph ph-bug"></i> Report a Bug</a><li><a href="/humans.txt" ><i class="ph ph-user-rectangle"></i> Humans</a><li><a href="/disclaimer" ><i class="ph ph-info"></i> License & Disclaimer</a><li><a href="/privacy" ><i class="ph ph-cookie"></i> Privacy</a><li><a href="/starsharks" ><i class="ph ph-sparkle"></i> Starsharks</a><li><a href="/chipotle" ><i class="ph ph-pepper"></i> Chipotle</a><li><a href="/misc" ><i class="ph ph-paperclip"></i> Junk Drawer</a><li><a href="/ocean" ><i class="ph ph-waves"></i> the Ocean</a><li><a href="/void" ><i class="ph ph-spiral"></i> the Void</a><li class="menu_section">Other<li><a href="/public.pgp" ><i class="ph ph-key"></i> PGP Public Key</a><li><a href="https://infosec.pub/c/cybersecurity" target="_blank"><i class="ph ph-hamburger"></i> Infosec.Pub</a><li><a href="https://malici.ous.computer/@shellsharks" target="_blank"><i class="ph ph-linux-logo"></i> malici.ous.computer</a><li><a href="https://mastodon.social/@sass" target="_blank"><i class="ph-fill ph-mastodon-logo"></i> Mastodon.Social</a><li><a href="https://discord.gg/3rkHgtcYbb" target="_blank"><i class="ph ph-discord-logo"></i> Shellsharks Discord</a><li><a href="https://www.linkedin.com/in/mikesass" target="_blank"><i class="ph ph-linkedin-logo"></i> Linkedin</a><li><a href="/toots/infosec-exchange/shellsharks/" ><i class="ph ph-database"></i> Infosec.exchange Toot Archive</a><li><a href="https://github.com/shellsharks" target="_blank"><i class="ph ph-github-logo"></i> Github</a><li><a href="https://fediverse-webring-enthusiasts.glitch.me/profiles/shellsharks_infosec.exchange/index.html" target="_blank"><i class="ph ph-circle"></i> Webring Enthusiasts</a><li><a href="https://fedia.io/m/cybersecurity" target="_blank"><i class="ph ph-square-half"></i> Fedia.io</a></ul></nav><main class="container_item"><div class="pageheader"> <img src="https://shellsharks-images.s3.amazonaws.com/2021/sorcerer-shark.png" width="250"></div><article class="post h-entry"><header class="post-header"><h1 class="post-title p-name" id="title" style="display:inline;">Sqlmagic, the Tamper Spell</h1><span style="color:#CA3342;font-size:4em;line-height: 20px;">.</span></header><!--<div id="postinfo"> <span class="time"><i class="ph ph-note-pencil"></i> by <span class="hov p-author h-card">Mike Sass</span> <a href="/about" rel="author"><img class="u-photo" src="https://shellsharks-images.s3.amazonaws.com/surfshark.png" style="display:inline; height:1em;" /></a></span><br/> <br/> <span class="categories"> &raquo; infosec, blog </span></div>--><div class="post-content e-content" style="margin-top: 30px;"><p>Since <a href="https://owasp.org/www-pdf-archive/OWASP_Top_10_-_2013.pdf">(at least) 2010</a>, <a href="https://owasp.org/www-community/attacks/SQL_Injection">SQL Injection</a> (and other types of <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Injection</a>) has been number one (<em>A1</em>) on <a href="https://owasp.org">OWASP’s</a> famed <a href="https://owasp.org/www-project-top-ten/">OWASP Top Ten</a> list. The OWASP Top 10 (for those who aren’t familiar) represents the top 10 “most critical security risks to web applications” and is developed (by OWASP) using a broad consensus from within the (global) appsec community. “Risk” in this case, is <a href="https://www.synopsys.com/glossary/what-is-owasp-top-10.html#2">measured not only on severity and impact but also on the relative frequency</a> of the vulnerability class. In other words, <strong>SQLi</strong> is <em>consistently</em> ranked at the top, year after year, not only because it represents significant risk to any given application (and potentially its underlying infrastructure) but also because it is <em>very</em> frequently found.<p>There are many variants of <a href="https://portswigger.net/web-security/sql-injection">SQLi</a>, yet finding and subsequently exploiting this flaw is not always trivial. However, application security professionals have a magic weapon that does exactly this - <strong><a href="https://sqlmap.org">SQLMAP</a></strong>! (Find it <a href="https://github.com/sqlmapproject/sqlmap">here</a> or in a <a href="https://www.kali.org">Kali</a> image near you!)<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        ___
       __H__
 ___ ___[(]_____ ___ ___
|_ -| . [,]     | .'| . |
|___|_  [']_|_|_|__,|  _|
      |_|V...       |_|
</code></pre></div></div><p><em>Before reading any further, know that this is not a guide to using <a href="https://sqlmap.org">sqlmap</a>. For that, I recommend you check out the <a href="https://github.com/sqlmapproject/sqlmap">Github project for sqlmap</a> and read through it’s <a href="https://github.com/sqlmapproject/sqlmap/wiki/Usage">usage documentation</a></em>.<h1 id="tamper-scripts">Tamper Scripts</h1><p>Let’s discuss the <em>awesomeness</em> that is <em><a href="https://sqlmap.org">sqlmap</a></em> <strong>Tamper scripts</strong> (invoked using <em>sqlmap</em> via the command-line parameter “<em>--tamper=TAMPER</em>”). To explain Tamper scripts, I’ll start with <em>sqlmap</em>’s own <a href="https://github.com/sqlmapproject/sqlmap/wiki/Usage">documentation</a>…<blockquote><p>sqlmap itself does no obfuscation of the payload sent, except for strings between single quotes replaced by their CHAR()-alike representation.</blockquote><blockquote><p>This option can be very useful and powerful in situations where there is a weak input validation mechanism between you and the back-end database management system. This mechanism usually is a self-developed input validation routine called by the application source code, an expensive enterprise-grade IPS appliance or a web application firewall (WAF). All buzzwords to define the same concept, implemented in a different way and costing lots of money, usually.</blockquote><blockquote><p>To take advantage of this option, provide sqlmap with a comma-separated list of tamper scripts and this will process the payload and return it transformed. You can define your own tamper scripts, use sqlmap ones from the tamper/ folder or edit them as long as you concatenate them comma-separated as value of the option –tamper (e.g. –tamper=”between,randomcase”).</blockquote><p><em>Cool right</em>?! Who doesn’t want to <a href="https://www.websec.ca/publication/Blog/Bypassing_WAFs_with_SQLMap">bypass WAFs</a>? In addition to fuzzing / otherwise-testing poor <a href="https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html">input validation</a> methods, Tamper scripts are also helpful when targeting particularly challenging injection vectors, an example of which I will describe in detail below…<h1 id="a-difficult-injection-vector">A Difficult Injection Vector</h1><p>I recently encountered an interesting <a href="https://owasp.org/www-community/attacks/SQL_Injection">SQLi</a> vulnerability that was <em>somewhat</em> difficult to inject into, specifically with <em><a href="https://sqlmap.org">sqlmap</a></em>, which is my go-to SQLi exploitation (<em>and often discovery</em>) utility. To set the scene, the web app in question had a simple <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET">GET</a> parameter “<em>id=1</em>”. Naturally I first tried to inject directly into the GET parameter but came up empty both with manual exploitation as well as using <em>sqlmap</em>…<blockquote><p>[WARNING] GET parameter ‘id’ does not seem to be injectable</blockquote><p><em>Bummer</em>… Taking a closer look at the application logic, I noticed a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">cookie</a> was being set as a result of submitting the GET request. The cookie was set as shown below…<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">Set-Cookie: userchl2_info=%7B%22last_book%22%3A%22MQ%3D%3D%22%2C%22userchl2%22%3A%22%22%7D
</span></code></pre></div></div><p>Subsequent requests anywhere within that <a href="https://www.paladion.net/blogs/cookie-attributes-and-their-importance#domain-and-path">same subdomain/path</a> would include that cookie value. When (<a href="https://www.w3schools.com/tags/ref_urlencode.ASP">URL</a>-)<a href="https://portswigger.net/burp/documentation/desktop/tools/decoder">decoding</a> the cookie value (<em>%7B%22last_book%22%3A%22MQ%3D%3D%22%2C%22userchl2%22%3A%22%22%7D</em>), I get the unencoded value, <em>{“last_book”:”MQ==”,”userchl2”:”“}</em>. I can see that the value for the <a href="https://www.w3resource.com/JSON/structures.php">dictionary</a> pair with key “<em>last_book</em>” appears to be <a href="https://en.wikipedia.org/wiki/Base64">base64</a> encoded (the equal signs “=”, which serve as base64 <a href="https://stackoverflow.com/questions/4080988/why-does-base64-encoding-require-padding-if-the-input-length-is-not-divisible-by">padding</a> give this away). Further (base64)-decoding that value I see that <em>MQ==</em> is equal to the value “1”, which is of course the original GET parameter value of <em>id</em> which was also 1!<p>OK, so now that I know how the GET parameter is stored within the cookie, I then inject a <em>properly encoded</em> (remember we must base64 encode the <em>last_book</em> value as well as URL encode the entire cookie value) <a href="https://www.netsparker.com/blog/web-security/fragmented-sql-injection-attacks/">apostrophe</a> (<strong>‘</strong>) into that <a href="https://www.json.org/json-en.html">JSON</a> key/value pair to see if I can’t trigger a SQL <a href="https://infosecwriteups.com/exploiting-error-based-sql-injections-bypassing-restrictions-ed099623cd94">error</a> (<em>in typical SQLi testing fashion</em>). After base64 encoding the apostrophe, the result is “<em>Jw==</em>”. After URL encoding the entire payload cookie value I have <em>%7B%22last_book%22%3A%22Jw%3D%3D%22%2C%22userchl2%22%3A%22%22%7D</em>.<p>Submitting this new payload, I find the following SQL error in the response.<blockquote><p>mysql_fetch_assoc() expects parameter 1 to be resource, boolean given in [redacted].php</blockquote><p><em>Eureka</em>! This error demonstrates that I may indeed have a <a href="https://portswigger.net/web-security/sql-injection">SQLi</a> flaw. To continue to <a href="http://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet">exploit this manually</a> given the multiple encoding steps as well as the need to inject it into a particular location of the cookie value would be exhausting. Why not instead have <em><a href="https://sqlmap.org">sqlmap</a></em> do the heavy lifting? By default, <em>sqlmap</em> does not handle the transforms and pinpoint accuracy required to pull this off. However, with the added functionality of Tamper scripting, we can extend <em>sqlmap</em>’s capabilities and do exactly that.<h1 id="becoming-a-tampermage">Becoming a Tampermage</h1><p><em><a href="https://sqlmap.org">Sqlmap</a></em> has a variety of <em>out-of-the-box</em> Tamper scripts, all of which can be found in <em>/share/sqlmap/tamper/</em>. The one’s that come standard as well as any additional home-brewed scripts will all have the general format shown below…<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Needed imports
</span><span class="kn">from</span> <span class="n">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>

<span class="c1"># Define which is the order of application of tamper scripts against
# the payload
</span><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="p">.</span><span class="n">NORMAL</span>

<span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
    <span class="sh">'''</span><span class="s">
    Description of your tamper script
    </span><span class="sh">'''</span>

    <span class="n">retVal</span> <span class="o">=</span> <span class="n">payload</span>

    <span class="c1"># your code to tamper the original payload
</span>
    <span class="c1"># return the tampered payload
</span>    <span class="k">return</span> <span class="n">retVal</span>
</code></pre></div></div><p>Using a (single) Tamper script is easy, you can even <a href="https://forum.bugcrowd.com/t/sqlmap-tamper-scripts-sql-injection-and-waf-bypass/423">chain multiple Tamper scripts</a> together! Example usage is show below…<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python sqlmap.py <span class="nt">-u</span> <span class="s2">"http://192.168.136.131/sqlmap/mysql/get_int.php?id=1"</span> <span class="nt">--</span><span class="se">\</span>
tamper tamper/between.py,tamper/randomcase.py,tamper/space2comment.py <span class="nt">-v</span> 3
</code></pre></div></div><p>Of course, there was no exact out-of-the-box script that would do everything I needed in this particular use-case, so I needed to develop my own from scratch or at least modify an existing script. To get me started, I used the <em>base64encode.py</em> Tamper script as a launch point as I knew I needed to do <em>some</em> base64 encoding. This script in it’s (original) entirety is displayed below…<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span>
<span class="sh">"""</span><span class="s">
Copyright (c) 2006-2021 sqlmap developers (http://sqlmap.org/)
See the file </span><span class="sh">'</span><span class="s">LICENSE</span><span class="sh">'</span><span class="s"> for copying permission
</span><span class="sh">"""</span>

<span class="kn">from</span> <span class="n">lib.core.convert</span> <span class="kn">import</span> <span class="n">encodeBase64</span>
<span class="kn">from</span> <span class="n">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>

<span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="p">.</span><span class="n">LOW</span>

<span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Base64-encodes all characters in a given payload
</span><span class="gp">
    &gt;&gt;&gt;</span> <span class="nf">tamper</span><span class="p">(</span><span class="sh">"</span><span class="s">1</span><span class="sh">'</span><span class="s"> AND SLEEP(5)#</span><span class="sh">"</span><span class="p">)</span>
    <span class="sh">'</span><span class="s">MScgQU5EIFNMRUVQKDUpIw==</span><span class="sh">'</span>
    <span class="sh">"""</span>

    <span class="k">return</span> <span class="nf">encodeBase64</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">payload</span> <span class="k">else</span> <span class="n">payload</span>
</code></pre></div></div><p><em>Alright</em>, so this is a good start. Let’s recap what I need out of my final Tamper script in order to inject the properly encoded payload in the exact right location…<ol><li>I need to inject into the <em>userchl2_info</em> cookie value.<li>The payloads generated by <em>sqlmap</em> must be wrapped in the JSON dict <em>{“last_book”:”[PAYLOAD]”,”userchl2”:”“}</em> (which is the properly formatted value for the injectable cookie).<li><em>sqlmap</em> payloads must be base64-encoded.<li>The entire cookie value must be URL-encoded.</ol><p><em>OK</em>… so to do this, I changed the final <em>return</em> statement in the original <em>base64encode.py</em> Tamper script to the <em>return</em> statement shown below…<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="nf">quote_plus</span><span class="p">(</span><span class="sh">'</span><span class="s">{</span><span class="sh">"</span><span class="s">last_book</span><span class="sh">"</span><span class="s">:</span><span class="sh">"'</span> <span class="o">+</span> <span class="nf">encodeBase64</span><span class="p">(</span><span class="sh">"</span><span class="s">9999</span><span class="sh">"</span> <span class="o">+</span> <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="sh">'"</span><span class="s">,</span><span class="sh">"</span><span class="s">userchl2</span><span class="sh">"</span><span class="s">:</span><span class="sh">""</span><span class="s">}</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div><p>Quickly decomposing this one-liner as it relates to my previously stated requirements…<ol><li>I can inject my (<em>tamper-transformed</em>) payloads into the cookie as part of a <em>sqlmap</em> command by setting the <em>--cookie</em> parameter to ‘<em>--cookie=”userchl2_info=”‘</em>.<li>In the new <em>return</em> statement, I have <em>{“last_book”:”’ + [PAYLOAD STUFF] + ‘”,”userchl2”:”“}</em> which satisfies the JSON wrap.<li>Using <em>encodeBase64(“9999” + payload[1:],binary=False)</em>, I am able to encode the inner-payload as base64.<li>Finally I use <em>urllib.parse.quote_plus(…)</em> to URL-encode the cookie value in it’s totality.</ol><p>Putting this all-together in my <em>sqlmap</em> command…<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="nt">-u</span> <span class="s2">"[redacted].php?id=1"</span> <span class="nt">--cookie</span><span class="o">=</span><span class="s2">"userchl2_info="</span> <span class="nt">-p</span> <span class="s2">"userchl2_info"</span> <span class="nt">--tamper</span><span class="o">=</span><span class="s2">"/usr/share/sqlmap/tamper/base64encode2.py"</span> <span class="nt">--dbms</span><span class="o">=</span>MySQL <span class="nt">--not-string</span><span class="o">=</span><span class="s2">"expects parameter 1 to be resource"</span> <span class="nt">--level</span><span class="o">=</span>3
</code></pre></div></div><p><strong>*</strong> <em>Remember I discovered the DB was MySQL earlier when I first triggered the SQL error.</em><br /> <strong>*</strong> <em>I also discovered the “--not-string” when I first triggered the original SQL error.</em><br /> <strong>*</strong> <em>I’m not sure why (some more digging is needed), but for this to work, sqlmap must be run with Level 3, --level=3.</em><p>Running this command I get a lot of output - most importantly I see…<blockquote><p>[INFO] heuristic (basic) test shows that Cookie parameter ‘userchl2_info’ might be injectable (possible DBMS: ‘MySQL’) <br /> Cookie parameter ‘userchl2_info’ is ‘Generic UNION query (NULL) - 1 to 20 columns’ injectable <br /> Cookie parameter ‘userchl2_info’ is vulnerable.</blockquote><p>In other words, this injection vector was successful and I was indeed able to dump the database. The big takeaway here is that Tamper scripts are awesome and you can <em>easily</em> create your own which can precisely target and ruthlessly fuzz potential injection vectors.<p>I now graduate as a sql(map) Tamper-wiz!</div></article><hr class="fin"><div id="poststats" class="containbox" style="margin: auto;"> <span class="time"><i class="ph ph-calendar-dot"></i> Published: <span class="dt-published">July 27, 2021</span></span> <a class="u-url u-uid" href></a><br> <span class="categories"><i class="ph ph-tag"></i> Tags: <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=infosec">#infosec</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=appsec">#appsec</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=pentesting">#pentesting</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=red">#red</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=kali">#kali</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=training">#training</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=burp">#burp</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=technical">#technical</a></span> </span><br/> <span class="time"><i class="ph ph-pencil"></i> Word count: 1658</span> <span class="p-summary" style="display:none;">How to use Sqlmap Tamper scripts to inject precise, transform-required payloads.</span></div><br/><div class="PageNavigation"> <a class="prev" style="margin-right: 2em;" href="/tesla#title">&laquo; Shock & Awe, a Tesla Revue</a><div style="float:right;"><a class="next" href="/cybersecurity-role-map#title" style="margin-right:0;">Cybersecurity Role Map &raquo;</a></div></div></main><aside class="container_item"></aside><footer class="container_item"> <center><span style="color:var(--light-font-color); font-size:.8em; font-style:italic; position:relative; top:25px;">Brought to you with <i class="ph-fill ph-heart-straight" style="color:var(--accent-color);"></i> by <a href="https://shellsharks.com/about">Shellsharks</a></span></center> <center> <img id="sharkfooter" src="/assets/img/sharks-circling.png" alt="Circling Sharks" style="width:150px;"></img> &nbsp;&nbsp;&nbsp; <span class="red" height="20px">•</span> &nbsp;&nbsp;&nbsp;<a href="https://www.instagram.com/angryrolypoly/"><i class="ph ph-palette" title="angryrolypoly"></i> by angryrolypoly</a> </center></footer></div><noscript><div class="panel" align="center" style="font-weight:bold;"><h1>Please enable JavaScript.</h1></div></noscript> <script src="/assets/js/themeswitcher.js"></script>
